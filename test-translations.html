<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Translations - Estudio Artesana</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        .debug-section {
            background: #f5f5f5;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .product-card {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .language-toggle {
            margin: 20px 0;
        }
        .lang-btn {
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            border: 2px solid #333;
            background: white;
            border-radius: 5px;
        }
        .lang-btn.active {
            background: #333;
            color: white;
        }
        pre {
            background: #222;
            color: #0f0;
            padding: 10px;
            overflow-x: auto;
            border-radius: 5px;
        }
        .error { color: red; }
        .success { color: green; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <h1>üîç Translation System Debug</h1>

    <div class="language-toggle">
        <button class="lang-btn active" onclick="switchLang('es')">ES</button>
        <button class="lang-btn" onclick="switchLang('en')">EN</button>
        <span id="currentLang">Current: es</span>
    </div>

    <div class="debug-section">
        <h2>System Status</h2>
        <div id="systemStatus">Checking...</div>
    </div>

    <div class="debug-section">
        <h2>First 3 Products (with translations)</h2>
        <div id="productsDebug">Loading...</div>
    </div>

    <div class="debug-section">
        <h2>Translation Test</h2>
        <div id="translationTest">Testing...</div>
    </div>

    <script src="js/supabase-api-client.js"></script>
    <script src="assets/js/translation-system.js"></script>

    <script>
        let testProducts = [];

        async function checkSystem() {
            const status = document.getElementById('systemStatus');
            let html = '<ul>';

            // Check API
            if (window.artesanaAPI) {
                html += '<li class="success">‚úÖ Supabase API loaded</li>';
            } else {
                html += '<li class="error">‚ùå Supabase API NOT loaded</li>';
            }

            // Check Translation System
            if (window.TranslationSystem) {
                html += '<li class="success">‚úÖ Translation System loaded</li>';
                html += `<li>Current language: <strong>${window.TranslationSystem.currentLanguage}</strong></li>`;
                html += `<li>Initialized: <strong>${window.TranslationSystem.isInitialized}</strong></li>`;
            } else {
                html += '<li class="error">‚ùå Translation System NOT loaded</li>';
            }

            html += '</ul>';
            status.innerHTML = html;
        }

        async function loadProducts() {
            const debug = document.getElementById('productsDebug');

            try {
                debug.innerHTML = '<p>Loading products from API...</p>';

                const response = await window.artesanaAPI.getProducts(1, 3);
                testProducts = response.products;

                console.log('üîç Products loaded:', testProducts);

                let html = '';
                testProducts.forEach((product, index) => {
                    html += `
                        <div class="product-card">
                            <h3>Product ${index + 1}: ${product.name}</h3>
                            <p><strong>ID:</strong> ${product.id}</p>
                            <p><strong>Has translations object:</strong> ${!!product.translations ? 'YES' : 'NO'}</p>

                            ${product.translations ? `
                                <p><strong>Available languages:</strong> ${Object.keys(product.translations).join(', ')}</p>

                                ${product.translations.es ? `
                                    <div>
                                        <strong>Spanish (es):</strong>
                                        <ul>
                                            <li>Name: ${product.translations.es.name || 'N/A'}</li>
                                            <li>Short desc: ${product.translations.es.short_description || 'N/A'}</li>
                                        </ul>
                                    </div>
                                ` : '<p class="warning">‚ö†Ô∏è No Spanish translation</p>'}

                                ${product.translations.en ? `
                                    <div>
                                        <strong>English (en):</strong>
                                        <ul>
                                            <li>Name: ${product.translations.en.name || 'N/A'}</li>
                                            <li>Short desc: ${product.translations.en.short_description || 'N/A'}</li>
                                        </ul>
                                    </div>
                                ` : '<p class="warning">‚ö†Ô∏è No English translation</p>'}
                            ` : '<p class="error">‚ùå No translations object found</p>'}

                            <details>
                                <summary>Full product object</summary>
                                <pre>${JSON.stringify(product, null, 2)}</pre>
                            </details>
                        </div>
                    `;
                });

                debug.innerHTML = html;
                testTranslations();

            } catch (error) {
                console.error('‚ùå Error loading products:', error);
                debug.innerHTML = `<p class="error">Error: ${error.message}</p>`;
            }
        }

        function testTranslations() {
            const test = document.getElementById('translationTest');

            if (!testProducts || testProducts.length === 0) {
                test.innerHTML = '<p class="warning">No products loaded yet</p>';
                return;
            }

            const product = testProducts[0];
            const currentLang = window.TranslationSystem.currentLanguage;

            let html = `
                <h3>Testing product: ${product.name}</h3>
                <p><strong>Current language:</strong> ${currentLang}</p>
            `;

            // Test getProductField
            const translatedName = window.TranslationSystem.getProductField(product, 'name');
            const translatedDesc = window.TranslationSystem.getProductField(product, 'description');

            html += `
                <div>
                    <h4>getProductField Results:</h4>
                    <ul>
                        <li><strong>Original name:</strong> ${product.name}</li>
                        <li><strong>Translated name:</strong> ${translatedName}</li>
                        <li class="${translatedName !== product.name ? 'success' : 'warning'}">
                            ${translatedName !== product.name ? '‚úÖ Translation working!' : '‚ö†Ô∏è Same as original'}
                        </li>
                    </ul>
                </div>
            `;

            // Test translateProduct
            const translated = window.TranslationSystem.translateProduct(product);
            html += `
                <div>
                    <h4>translateProduct Results:</h4>
                    <pre>${JSON.stringify(translated, null, 2)}</pre>
                </div>
            `;

            test.innerHTML = html;
        }

        function switchLang(lang) {
            // Update buttons
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Switch language
            if (window.TranslationSystem) {
                window.TranslationSystem.switchLanguage(lang);
                document.getElementById('currentLang').textContent = `Current: ${lang}`;

                // Re-run translation test
                setTimeout(() => {
                    checkSystem();
                    testTranslations();
                }, 500);
            }
        }

        // Initialize when ready
        window.addEventListener('load', async () => {
            await checkSystem();
            setTimeout(loadProducts, 1000);
        });
    </script>
</body>
</html>
