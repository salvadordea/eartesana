<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug WooCommerce - Estudio Artesana</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        .debug-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>üîç WooCommerce API Debug - Estudio Artesana</h1>
    
    <div class="debug-container">
        <h2>üìã Configuraci√≥n</h2>
        <div id="config-status"></div>
        <pre id="config-data"></pre>
    </div>

    <div class="debug-container">
        <h2>üß™ Pruebas de Conexi√≥n</h2>
        <button onclick="testConnection()">üîó Probar Conexi√≥n</button>
        <button onclick="testCategories()">üì¶ Probar Categor√≠as</button>
        <button onclick="testProducts()">üõçÔ∏è Probar Productos</button>
        <div id="test-results"></div>
    </div>

    <div class="debug-container">
        <h2>üìä Resultados</h2>
        <div id="results"></div>
    </div>

    <!-- Scripts (loaded dynamically for robustness) -->
    <script>
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const s = document.createElement('script');
                s.src = src;
                s.async = false;
                s.onload = resolve;
                s.onerror = () => reject(new Error('No se pudo cargar: ' + src));
                document.head.appendChild(s);
            });
        }

        async function loadCoreScripts() {
            const errors = [];
            try {
                await loadScript('assets/js/config.js');
            } catch (e1) {
                errors.push(e1.message);
                try { await loadScript('config.js'); } catch (e2) { errors.push(e2.message); }
            }
            try {
                await loadScript('assets/js/woocommerce-api.js');
            } catch (e3) { errors.push(e3.message); }
            return errors;
        }

        // Wait for config to load
        function waitForConfig() {
            return new Promise((resolve) => {
                if (typeof EstudioArtesanaConfig !== 'undefined') {
                    resolve();
                } else {
                    setTimeout(() => waitForConfig().then(resolve), 100);
                }
            });
        }

        // Initialize API
        let api;

        document.addEventListener('DOMContentLoaded', async function() {
            const loadErrors = await loadCoreScripts();
            if (loadErrors.length) {
                const configStatus = document.getElementById('config-status');
                configStatus.innerHTML += `<div class="status error">‚ö†Ô∏è Problemas cargando scripts: <pre>${loadErrors.join('\n')}</pre></div>`;
            }
            await waitForConfig();
            displayConfig();
            initializeAPI();
        });

        function displayConfig() {
            const configStatus = document.getElementById('config-status');
            const configData = document.getElementById('config-data');
            
            if (typeof EstudioArtesanaConfig !== 'undefined' && EstudioArtesanaConfig.woocommerce) {
                configStatus.innerHTML = '<div class="status success">‚úÖ Configuraci√≥n cargada correctamente</div>';
                
                // Mask sensitive data
                const config = { ...EstudioArtesanaConfig.woocommerce };
                config.consumerKey = config.consumerKey ? config.consumerKey.substr(0, 8) + '...' : 'No configurado';
                config.consumerSecret = config.consumerSecret ? config.consumerSecret.substr(0, 8) + '...' : 'No configurado';
                
                configData.textContent = JSON.stringify(config, null, 2);
            } else {
                configStatus.innerHTML = '<div class="status error">‚ùå Error: Configuraci√≥n no encontrada</div>';
            }
        }

        function initializeAPI() {
            try {
                if (EstudioArtesanaConfig && EstudioArtesanaConfig.woocommerce) {
                    const config = EstudioArtesanaConfig.woocommerce;
                    api = new WooCommerceAPI({
                        baseURL: config.baseURL,
                        apiPath: '/wp-json/wc/v3'
                    });
                    api.setCredentials(config.consumerKey, config.consumerSecret);
                    
                    document.getElementById('config-status').innerHTML += 
                        '<div class="status success">‚úÖ API inicializada correctamente</div>';
                } else {
                    throw new Error('Configuraci√≥n WooCommerce no encontrada');
                }
            } catch (error) {
                document.getElementById('config-status').innerHTML += 
                    `<div class="status error">‚ùå Error inicializando API: ${error.message}</div>`;
            }
        }

        async function testConnection() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<div class="status info">üîÑ Probando conexi√≥n...</div>';
            
            try {
                // Test basic connection
                const url = `${EstudioArtesanaConfig.woocommerce.baseURL}/wp-json/wc/v3/products`;
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Basic ${btoa(EstudioArtesanaConfig.woocommerce.consumerKey + ':' + EstudioArtesanaConfig.woocommerce.consumerSecret)}`
                    }
                });
                
                if (response.ok) {
                    results.innerHTML = '<div class="status success">‚úÖ Conexi√≥n exitosa!</div>';
                } else {
                    results.innerHTML = `<div class="status error">‚ùå Error de conexi√≥n: ${response.status} - ${response.statusText}</div>`;
                }
            } catch (error) {
                results.innerHTML = `<div class="status error">‚ùå Error de red: ${error.message}</div>`;
            }
        }

        async function testCategories() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="status info">üîÑ Cargando categor√≠as...</div>';
            
            try {
                const categories = await api.getCategories();
                results.innerHTML = `
                    <div class="status success">‚úÖ ${categories.length} categor√≠as cargadas</div>
                    <pre>${JSON.stringify(categories.slice(0, 3), null, 2)}</pre>
                `;
            } catch (error) {
                results.innerHTML = `<div class="status error">‚ùå Error cargando categor√≠as: ${error.message}</div>`;
            }
        }

        async function testProducts() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="status info">üîÑ Cargando productos...</div>';
            
            try {
                const products = await api.getProducts({ per_page: 5 });
                results.innerHTML = `
                    <div class="status success">‚úÖ ${products.length} productos cargados</div>
                    <pre>${JSON.stringify(products.map(p => ({
                        id: p.id,
                        name: p.name,
                        price: p.price,
                        status: p.status
                    })), null, 2)}</pre>
                `;
            } catch (error) {
                results.innerHTML = `<div class="status error">‚ùå Error cargando productos: ${error.message}</div>`;
            }
        }

        // Auto-test on load
        setTimeout(() => {
            if (api) {
                testConnection();
            }
        }, 1000);
    </script>
</body>
</html>
