<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci칩n - Estudio Artesana</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            color: #333;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            background: rgba(0,0,0,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header h2 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-item {
            display: block;
            padding: 12px 20px;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s ease;
            border-left: 3px solid transparent;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.1);
            border-left-color: #D4AF37;
        }

        .nav-item i {
            width: 20px;
            margin-right: 10px;
        }

        .main-content {
            margin-left: 250px;
            padding: 20px;
            min-height: 100vh;
        }

        .top-bar {
            background: white;
            padding: 15px 30px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 1.5rem;
            color: #2c3e50;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin-right: 15px;
        }

        .card-title {
            font-size: 1.2rem;
            color: #2c3e50;
        }

        .card-description {
            color: #7f8c8d;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .card-action {
            padding: 8px 15px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            color: #495057;
            text-decoration: none;
            font-size: 0.9rem;
            display: inline-block;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .card-action:hover {
            background: #D4AF37;
            color: white;
            border-color: #D4AF37;
        }

        .content-area {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: none;
        }

        .content-area.active {
            display: block;
        }

        /* Inventory Styles */
        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .inventory-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #D4AF37, #B8941F);
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .filters-bar {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-weight: 600;
            font-size: 12px;
            color: #495057;
        }

        .filter-group input,
        .filter-group select {
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }

        .table-container {
            overflow-x: auto;
            margin-bottom: 20px;
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .inventory-table th,
        .inventory-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .inventory-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .inventory-table tr:hover {
            background: #f8f9fa;
        }

        .product-img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-low-stock {
            background: #fff3cd;
            color: #856404;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .pagination-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .loading-row {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        /* Contact Editor Styles */
        .contact-editor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .editor-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }
        
        .editor-section h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .editor-section p {
            color: #6c757d;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
            font-size: 14px;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #D4AF37;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }
        
        .form-group small {
            color: #6c757d;
            font-size: 12px;
            display: block;
            margin-top: 5px;
        }
        
        .card-editor {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
        }
        
        .card-editor h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .editor-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            padding: 20px 0;
            border-top: 1px solid #e9ecef;
            margin-top: 20px;
        }
        
        .trust-icons-form .form-group {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
        }
        
        .social-form .form-group {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: #fefefe;
            padding: 0;
            border: none;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-header {
            background: linear-gradient(135deg, #D4AF37, #B8941F);
            color: white;
            padding: 20px 25px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .modal-close {
            color: white;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .modal-form .form-group {
            margin-bottom: 20px;
        }
        
        .modal-form .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }
        
        .modal-form .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        
        .modal-form .form-control:focus {
            outline: none;
            border-color: #D4AF37;
            background: white;
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
        }
        
        .modal-form .form-control:invalid {
            border-color: #dc3545;
        }
        
        .modal-form small {
            display: block;
            margin-top: 5px;
            color: #6c757d;
            font-size: 12px;
        }
        
        .modal-footer {
            background: #f8f9fa;
            padding: 20px 25px;
            border-radius: 0 0 15px 15px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            border-top: 1px solid #e9ecef;
        }
        
        .modal-footer .btn {
            padding: 10px 20px;
            font-weight: 600;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-success {
            background-color: #d1e7dd;
            color: #0f5132;
            border: 1px solid #badbcc;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            color: #664d03;
            border: 1px solid #ffecb5;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #58151c;
            border: 1px solid #f1aeb5;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            .main-content {
                margin-left: 0;
            }
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .filters-bar {
                flex-direction: column;
            }
            .inventory-header {
                flex-direction: column;
                gap: 15px;
            }
            .contact-editor-grid {
                grid-template-columns: 1fr;
            }
            .editor-actions {
                flex-direction: column;
                align-items: center;
            }
            .modal-content {
                width: 95%;
                margin: 10px;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2><i class="fas fa-tools"></i> Admin Panel</h2>
            <p>Estudio Artesana</p>
        </div>
        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" data-section="dashboard">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a href="inventario.html" class="nav-item">
                <i class="fas fa-boxes"></i> Inventario
            </a>
            <a href="image-upload-assistant.html" class="nav-item">
                <i class="fas fa-image"></i> Subir Im치genes
            </a>
            <a href="#" class="nav-item" data-section="ventas">
                <i class="fas fa-chart-line"></i> Panel de Ventas
            </a>
            <a href="#" class="nav-item" data-section="mayoristas">
                <i class="fas fa-users-cog"></i> Mayoristas
            </a>
            <a href="#" class="nav-item" data-section="usuarios">
                <i class="fas fa-users"></i> Usuarios
            </a>
            <a href="#" class="nav-item" data-section="banner">
                <i class="fas fa-bullhorn"></i> Banner Promo
            </a>
            <a href="#" class="nav-item" data-section="contacto">
                <i class="fas fa-address-card"></i> Info Contacto
            </a>
            <a href="#" class="nav-item" data-section="setup">
                <i class="fas fa-cog"></i> Configuraci칩n
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <h1 class="page-title" id="pageTitle">Dashboard</h1>
            <div class="user-info">
                <span id="userEmail">admin@artesana.com</span>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesi칩n
                </button>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboard" class="content-area active">
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="card-title">Gesti칩n de Inventario</div>
                    </div>
                    <div class="card-description">
                        Administra productos, categor칤as, precios, existencias y variantes. Agrega, edita, copia o elimina productos.
                    </div>
                    <div class="card-action" onclick="window.location.href='inventario.html'">
                        <i class="fas fa-arrow-right"></i> Administrar Inventario
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #28a745, #20c997);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="card-title">Panel de Ventas</div>
                    </div>
                    <div class="card-description">
                        Monitorea ventas diarias, gestiona pedidos y carritos abandonados. Visualiza m칠tricas de usuarios registrados.
                    </div>
                    <div class="card-action" onclick="showSection('ventas')">
                        <i class="fas fa-arrow-right"></i> Ver Panel de Ventas
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                            <i class="fas fa-users-cog"></i>
                        </div>
                        <div class="card-title">Usuarios Mayoristas</div>
                    </div>
                    <div class="card-description">
                        Gestiona usuarios con permisos mayoristas, crea nuevas cuentas, modifica precios especiales.
                    </div>
                    <div class="card-action" onclick="showSection('mayoristas')">
                        <i class="fas fa-arrow-right"></i> Gestionar Mayoristas
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="card-title">Usuarios Regulares</div>
                    </div>
                    <div class="card-description">
                        Administra usuarios regulares, modifica contrase침as, suspende o elimina cuentas.
                    </div>
                    <div class="card-action" onclick="showSection('usuarios')">
                        <i class="fas fa-arrow-right"></i> Gestionar Usuarios
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <div class="card-title">Banner Promocional</div>
                    </div>
                    <div class="card-description">
                        Modifica el contenido del banner promocional mensual que aparece en la p치gina principal.
                    </div>
                    <div class="card-action" onclick="showSection('banner')">
                        <i class="fas fa-arrow-right"></i> Editar Banner
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #1abc9c, #16a085);">
                            <i class="fas fa-address-card"></i>
                        </div>
                        <div class="card-title">Info de Contacto</div>
                    </div>
                    <div class="card-description">
                        Edita las tarjetas de contacto que aparecen en la p치gina principal.
                    </div>
                    <div class="card-action" onclick="showSection('contacto')">
                        <i class="fas fa-arrow-right"></i> Editar Contacto
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #e91e63, #ad1457);">
                            <i class="fas fa-image"></i>
                        </div>
                        <div class="card-title">Asistente de Subida de Im치genes</div>
                    </div>
                    <div class="card-description">
                        Gestiona las im치genes de productos, sube nuevas im치genes para productos con placeholders, y organiza la galer칤a visual.
                    </div>
                    <div class="card-action" onclick="window.location.href='image-upload-assistant.html'">
                        <i class="fas fa-arrow-right"></i> Subir Im치genes
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-icon" style="background: linear-gradient(135deg, #34495e, #2c3e50);">
                            <i class="fas fa-cog"></i>
                        </div>
                        <div class="card-title">Configuraci칩n del Sistema</div>
                    </div>
                    <div class="card-description">
                        Configura la conexi칩n a Supabase, verifica tablas y administra el sistema.
                    </div>
                    <div class="card-action" onclick="showSection('setup')">
                        <i class="fas fa-arrow-right"></i> Configurar Sistema
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Areas -->
        <div id="inventory" class="content-area">
            <div class="inventory-header">
                <h2>Gesti칩n de Inventario</h2>
                <div class="inventory-actions">
                    <button class="btn btn-primary" onclick="showAddProductModal()">
                        <i class="fas fa-plus"></i> Agregar Producto
                    </button>
                    <button class="btn btn-success" onclick="refreshInventory()">
                        <i class="fas fa-sync"></i> Actualizar
                    </button>
                </div>
            </div>

            <!-- Filtros -->
            <div class="filters-bar">
                <div class="filter-group">
                    <label>Categor칤a:</label>
                    <select id="categoryFilter" onchange="filterProducts()">
                        <option value="">Todas las categor칤as</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Buscar:</label>
                    <input type="text" id="searchFilter" placeholder="Nombre del producto..." onkeyup="filterProducts()">
                </div>
                <div class="filter-group">
                    <label>Estado:</label>
                    <select id="statusFilter" onchange="filterProducts()">
                        <option value="">Todos</option>
                        <option value="active">Activos</option>
                        <option value="inactive">Inactivos</option>
                        <option value="low-stock">Stock Bajo</option>
                    </select>
                </div>
            </div>

            <!-- Tabla de productos -->
            <div class="table-container">
                <table class="inventory-table" id="inventoryTable">
                    <thead>
                        <tr>
                            <th>Imagen</th>
                            <th>Nombre</th>
                            <th>Categor칤a</th>
                            <th>Precio</th>
                            <th>Stock</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTableBody">
                        <tr>
                            <td colspan="7" class="loading-row">
                                <i class="fas fa-spinner fa-spin"></i> Cargando productos...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Paginaci칩n -->
            <div class="pagination-container">
                <div class="pagination-info">
                    Mostrando <span id="paginationInfo">0-0 de 0</span> productos
                </div>
                <div class="pagination-controls">
                    <button class="btn btn-sm" onclick="changePage(-1)" id="prevPage">Anterior</button>
                    <span id="pageNumbers"></span>
                    <button class="btn btn-sm" onclick="changePage(1)" id="nextPage">Siguiente</button>
                </div>
            </div>
        </div>

        <div id="ventas" class="content-area">
            <h2>Panel de Ventas y Gesti칩n de Pedidos</h2>
            
            <!-- Resumen de Ventas -->
            <div class="sales-summary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid #28a745;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin: 0; color: #28a745; font-size: 0.9rem;">VENTAS HOY</h3>
                            <p style="font-size: 1.8rem; font-weight: bold; margin: 5px 0; color: #2c3e50;">$0.00</p>
                        </div>
                        <i class="fas fa-chart-line" style="font-size: 2rem; color: #28a745; opacity: 0.7;"></i>
                    </div>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid #17a2b8;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin: 0; color: #17a2b8; font-size: 0.9rem;">PEDIDOS PENDIENTES</h3>
                            <p style="font-size: 1.8rem; font-weight: bold; margin: 5px 0; color: #2c3e50;">0</p>
                        </div>
                        <i class="fas fa-clock" style="font-size: 2rem; color: #17a2b8; opacity: 0.7;"></i>
                    </div>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid #ffc107;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin: 0; color: #ffc107; font-size: 0.9rem;">CARRITOS ABANDONADOS</h3>
                            <p style="font-size: 1.8rem; font-weight: bold; margin: 5px 0; color: #2c3e50;">0</p>
                        </div>
                        <i class="fas fa-shopping-cart" style="font-size: 2rem; color: #ffc107; opacity: 0.7;"></i>
                    </div>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid #6f42c1;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin: 0; color: #6f42c1; font-size: 0.9rem;">USUARIOS REGISTRADOS</h3>
                            <p style="font-size: 1.8rem; font-weight: bold; margin: 5px 0; color: #2c3e50;">0</p>
                        </div>
                        <i class="fas fa-users" style="font-size: 2rem; color: #6f42c1; opacity: 0.7;"></i>
                    </div>
                </div>
            </div>
            
            <!-- Filtros y Controles -->
            <div class="sales-controls" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px;">
                <div style="display: flex; flex-wrap: wrap; gap: 15px; align-items: center; justify-content: space-between;">
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <div>
                            <label style="font-weight: 600; margin-bottom: 5px; display: block; color: #495057;">Estado del Pedido:</label>
                            <select id="orderStatusFilter" style="padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;">
                                <option value="">Todos los Estados</option>
                                <option value="pending">Pendiente</option>
                                <option value="paid">Pagado</option>
                                <option value="processing">Procesando</option>
                                <option value="shipped">Enviado</option>
                                <option value="delivered">Entregado</option>
                                <option value="cancelled">Cancelado</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="font-weight: 600; margin-bottom: 5px; display: block; color: #495057;">Periodo:</label>
                            <select id="periodFilter" style="padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;">
                                <option value="today">Hoy</option>
                                <option value="week">Esta Semana</option>
                                <option value="month" selected>Este Mes</option>
                                <option value="all">Todos</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <button class="btn btn-primary" onclick="refreshSalesData()">
                            <i class="fas fa-sync"></i> Actualizar Datos
                        </button>
                        <button class="btn btn-success" onclick="exportSalesReport()">
                            <i class="fas fa-download"></i> Exportar Reporte
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Lista de Pedidos -->
            <div class="orders-section" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-bottom: 20px; color: #2c3e50;">游늶 Historial de Pedidos</h3>
                
                <div class="table-container">
                    <table class="inventory-table" id="ordersTable" style="width: 100%;">
                        <thead>
                            <tr>
                                <th>ID Pedido</th>
                                <th>Cliente</th>
                                <th>Fecha</th>
                                <th>Total</th>
                                <th>Estado</th>
                                <th>M칠todo Pago</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                            <tr>
                                <td colspan="7" class="loading-row">
                                    <i class="fas fa-info-circle"></i> No hay pedidos para mostrar. 
                                    <br><small style="color: #666;">Los pedidos aparecer치n aqu칤 una vez que los usuarios realicen compras.</small>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Panel de Carritos Abandonados -->
            <div class="abandoned-carts-section" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-top: 20px;">
                <h3 style="margin-bottom: 20px; color: #2c3e50;">游 Carritos Abandonados y Recuperaci칩n</h3>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <i class="fas fa-info-circle" style="color: #856404;"></i>
                        <strong style="color: #856404;">Sistema de Recuperaci칩n Autom치tica Activo</strong>
                    </div>
                    <p style="color: #856404; margin: 0; font-size: 14px;">
                        Los carritos inactivos por m치s de 30 minutos son autom치ticamente detectados y se env칤an emails de recuperaci칩n con cupones de descuento.
                    </p>
                </div>
                
                <div class="table-container">
                    <table class="inventory-table" id="abandonedCartsTable" style="width: 100%;">
                        <thead>
                            <tr>
                                <th>Usuario/Email</th>
                                <th>Productos</th>
                                <th>Valor Total</th>
                                <th>Abandonado</th>
                                <th>Emails Enviados</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="abandonedCartsTableBody">
                            <tr>
                                <td colspan="7" class="loading-row">
                                    <i class="fas fa-shopping-cart"></i> No hay carritos abandonados.
                                    <br><small style="color: #666;">Los carritos abandonados aparecer치n aqu칤 cuando se detecten autom치ticamente.</small>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h4 style="margin-bottom: 10px; color: #495057;">丘뙖잺 Configuraci칩n de Recuperaci칩n</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <label style="font-weight: 600; margin-bottom: 5px; display: block; color: #495057; font-size: 12px;">Tiempo Abandono (min):</label>
                            <input type="number" value="30" min="15" max="180" style="width: 100%; padding: 6px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="font-weight: 600; margin-bottom: 5px; display: block; color: #495057; font-size: 12px;">Descuento (%):</label>
                            <input type="number" value="10" min="5" max="50" style="width: 100%; padding: 6px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="font-weight: 600; margin-bottom: 5px; display: block; color: #495057; font-size: 12px;">M치x Emails:</label>
                            <input type="number" value="3" min="1" max="5" style="width: 100%; padding: 6px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;">
                        </div>
                        <div style="display: flex; align-items: end;">
                            <button class="btn btn-primary" style="width: 100%;" onclick="updateRecoverySettings()">
                                <i class="fas fa-save"></i> Guardar Config
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="mayoristas" class="content-area">
            <h2>Administraci칩n de Mayoristas</h2>
            
            <!-- Resumen de Mayoristas -->
            <div class="mayoristas-summary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid #28a745;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin: 0; color: #28a745; font-size: 0.9rem;">MAYORISTAS ACTIVOS</h3>
                            <p style="font-size: 1.8rem; font-weight: bold; margin: 5px 0; color: #2c3e50;" id="activeMayoristasCount">0</p>
                        </div>
                        <i class="fas fa-user-check" style="font-size: 2rem; color: #28a745; opacity: 0.7;"></i>
                    </div>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid #ffc107;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin: 0; color: #ffc107; font-size: 0.9rem;">MAYORISTAS SUSPENDIDOS</h3>
                            <p style="font-size: 1.8rem; font-weight: bold; margin: 5px 0; color: #2c3e50;" id="suspendedMayoristasCount">0</p>
                        </div>
                        <i class="fas fa-user-times" style="font-size: 2rem; color: #ffc107; opacity: 0.7;"></i>
                    </div>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid #17a2b8;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin: 0; color: #17a2b8; font-size: 0.9rem;">PEDIDOS ESTE MES</h3>
                            <p style="font-size: 1.8rem; font-weight: bold; margin: 5px 0; color: #2c3e50;" id="monthlyOrdersCount">0</p>
                        </div>
                        <i class="fas fa-shopping-cart" style="font-size: 2rem; color: #17a2b8; opacity: 0.7;"></i>
                    </div>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid #6f42c1;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin: 0; color: #6f42c1; font-size: 0.9rem;">VENTAS MAYORISTAS</h3>
                            <p style="font-size: 1.8rem; font-weight: bold; margin: 5px 0; color: #2c3e50;" id="wholesaleSalesAmount">$0.00</p>
                        </div>
                        <i class="fas fa-chart-line" style="font-size: 2rem; color: #6f42c1; opacity: 0.7;"></i>
                    </div>
                </div>
            </div>
            
            <!-- Controles de Mayoristas -->
            <div class="mayoristas-controls" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px;">
                <div style="display: flex; flex-wrap: wrap; gap: 15px; align-items: center; justify-content: space-between;">
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <div>
                            <label style="font-weight: 600; margin-bottom: 5px; display: block; color: #495057;">Estado:</label>
                            <select id="mayoristasStatusFilter" style="padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;" onchange="filterMayoristas()">
                                <option value="">Todos los Estados</option>
                                <option value="active">Activos</option>
                                <option value="suspended">Suspendidos</option>
                                <option value="inactive">Inactivos</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="font-weight: 600; margin-bottom: 5px; display: block; color: #495057;">Buscar:</label>
                            <input type="text" id="mayoristasSearchFilter" placeholder="Nombre o email..." style="padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;" onkeyup="filterMayoristas()">
                        </div>
                    </div>
                    
                    <div>
                        <button class="btn btn-success" onclick="showAddMayoristaModal()">
                            <i class="fas fa-plus"></i> Nuevo Mayorista
                        </button>
                        <button class="btn btn-primary" onclick="refreshMayoristasData()">
                            <i class="fas fa-sync"></i> Actualizar
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Lista de Mayoristas -->
            <div class="mayoristas-section" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <h3 style="margin-bottom: 20px; color: #2c3e50;">游논 Gesti칩n de Mayoristas</h3>
                
                <div class="table-container">
                    <table class="inventory-table" id="mayoristasTable" style="width: 100%;">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Email</th>
                                <th>Empresa</th>
                                <th>Fecha Registro</th>
                                <th>Estado</th>
                                <th>Pedidos</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="mayoristasTableBody">
                            <tr>
                                <td colspan="7" class="loading-row">
                                    <i class="fas fa-spinner fa-spin"></i> Cargando mayoristas...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="usuarios" class="content-area">
            <div class="section-header">
                <h2><i class="fas fa-users"></i> Gesti칩n de Usuarios Regulares</h2>
                <div class="section-actions">
                    <button class="btn-primary" onclick="refreshUsers()">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                    <button class="btn-secondary" onclick="exportUsers()">
                        <i class="fas fa-download"></i> Exportar
                    </button>
                </div>
            </div>

            <!-- User Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background: #3498db;">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalUsers">0</h3>
                        <p>Total Usuarios</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: #2ecc71;">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="activeUsers">0</h3>
                        <p>Usuarios Activos</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: #f39c12;">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="usersWithOrders">0</h3>
                        <p>Con Pedidos</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: #e74c3c;">
                        <i class="fas fa-user-times"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="inactiveUsers">0</h3>
                        <p>Usuarios Inactivos</p>
                    </div>
                </div>
            </div>

            <!-- User Filters and Search -->
            <div class="filters-section">
                <div class="filter-row">
                    <div class="filter-group">
                        <input type="text" id="userSearchInput" placeholder="Buscar usuarios..." class="search-input">
                        <button onclick="searchUsers()" class="btn-search">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>

                    <div class="filter-group">
                        <select id="userStatusFilter" onchange="filterUsers()">
                            <option value="">Todos los estados</option>
                            <option value="active">Activos</option>
                            <option value="inactive">Inactivos</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <select id="userRegistrationFilter" onchange="filterUsers()">
                            <option value="">Cualquier fecha</option>
                            <option value="today">Hoy</option>
                            <option value="week">Esta semana</option>
                            <option value="month">Este mes</option>
                            <option value="year">Este a침o</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Users Table -->
            <div class="table-container">
                <table class="data-table" id="usersTable">
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Email</th>
                            <th>Tel칠fono</th>
                            <th>Estado</th>
                            <th>Registrado</th>
                            <th>Pedidos</th>
                            <th>칔ltimo Login</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <tr class="loading-row">
                            <td colspan="8" class="text-center">
                                <div class="loading-spinner"></div>
                                Cargando usuarios...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination-container">
                <div class="pagination-info">
                    Mostrando <span id="usersShowing">0</span> de <span id="usersTotal">0</span> usuarios
                </div>
                <div class="pagination-controls">
                    <button id="usersPrevBtn" onclick="changePage(-1)" disabled>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span id="usersPageInfo">P치gina 1 de 1</span>
                    <button id="usersNextBtn" onclick="changePage(1)" disabled>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- User Details Modal -->
        <div id="userDetailsModal" class="modal-overlay" style="display: none;">
            <div class="modal-content large-modal">
                <div class="modal-header">
                    <h3 id="userModalTitle">Detalles del Usuario</h3>
                    <button class="modal-close" onclick="closeUserModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="user-details-container">
                        <!-- User Basic Info -->
                        <div class="user-info-section">
                            <h4><i class="fas fa-user"></i> Informaci칩n Personal</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Nombre Completo</label>
                                    <input type="text" id="editUserName" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" id="editUserEmail" class="form-input" readonly>
                                </div>
                                <div class="form-group">
                                    <label>Tel칠fono</label>
                                    <input type="text" id="editUserPhone" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label>Estado</label>
                                    <select id="editUserStatus" class="form-input">
                                        <option value="true">Activo</option>
                                        <option value="false">Inactivo</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- User Statistics -->
                        <div class="user-stats-section">
                            <h4><i class="fas fa-chart-bar"></i> Estad칤sticas</h4>
                            <div class="stats-row">
                                <div class="stat-item">
                                    <span class="stat-label">Total de Pedidos:</span>
                                    <span class="stat-value" id="userTotalOrders">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Total Gastado:</span>
                                    <span class="stat-value" id="userTotalSpent">$0.00</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Productos en Carrito:</span>
                                    <span class="stat-value" id="userCartItems">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Lista de Deseos:</span>
                                    <span class="stat-value" id="userWishlistItems">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Orders -->
                        <div class="user-orders-section">
                            <h4><i class="fas fa-shopping-bag"></i> Pedidos Recientes</h4>
                            <div class="orders-list" id="userRecentOrders">
                                <div class="no-data">No hay pedidos recientes</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeUserModal()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="button" class="btn-danger" onclick="suspendUser()" id="suspendUserBtn">
                        <i class="fas fa-user-slash"></i> Suspender
                    </button>
                    <button type="button" class="btn-primary" onclick="saveUserChanges()" id="saveUserBtn">
                        <i class="fas fa-save"></i> Guardar Cambios
                    </button>
                </div>
            </div>
        </div>

        <div id="banner" class="content-area">
            <h2>Editor de Banner Promocional</h2>
            <p>Pr칩ximamente: Editor del banner monthly-promo...</p>
        </div>

        <div id="contacto" class="content-area">
            <h2>Editor de Informaci칩n de Contacto</h2>
            
            <div class="contact-editor-grid">
                <!-- Trust Icons Section -->
                <div class="editor-section">
                    <h3><i class="fas fa-shield-alt"></i> Elementos de Confianza</h3>
                    <p>Edita los 칤conos de confianza que aparecen en la secci칩n hero de inicio</p>
                    
                    <div class="trust-icons-form">
                        <div class="form-group">
                            <label>칈cono 1 - Env칤o</label>
                            <input type="text" id="trustIcon1Text" placeholder="Env칤o Gratis*" class="form-control">
                            <select id="trustIcon1Icon" class="form-control">
                                <option value="fas fa-truck">游뚴 Cami칩n (Env칤o)</option>
                                <option value="fas fa-shipping-fast">游닍 Env칤o R치pido</option>
                                <option value="fas fa-plane">九걾잺 Avi칩n</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>칈cono 2 - Artesanal</label>
                            <input type="text" id="trustIcon2Text" placeholder="Hecho a Mano" class="form-control">
                            <select id="trustIcon2Icon" class="form-control">
                                <option value="fas fa-hand-holding-heart">游녫 Hecho a Mano</option>
                                <option value="fas fa-hands">游뗿 Manos</option>
                                <option value="fas fa-hammer">游댣 Herramientas</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>칈cono 3 - Calidad</label>
                            <input type="text" id="trustIcon3Text" placeholder="Calidad Premium" class="form-control">
                            <select id="trustIcon3Icon" class="form-control">
                                <option value="fas fa-shield-alt">游띠勇 Escudo</option>
                                <option value="fas fa-award">游끥 Premio</option>
                                <option value="fas fa-star">救 Estrella</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Descargo de env칤o</label>
                            <input type="text" id="shippingDisclaimer" placeholder="*En compras superiores a $2,000.00" class="form-control">
                        </div>
                    </div>
                </div>

                <!-- Promotional Banner Section -->
                <div class="editor-section">
                    <h3><i class="fas fa-percent"></i> Banner Promocional</h3>
                    <p>Edita el descuento que aparece en el banner superior</p>

                    <div class="promo-form">
                        <div class="form-group">
                            <label>Descuento Promocional</label>
                            <input type="text" id="promoDiscount" placeholder="25% OFF" class="form-control">
                            <small>Ej: 25% OFF, 50% DESCUENTO, OFERTA ESPECIAL</small>
                        </div>
                    </div>
                </div>

                <!-- Social Media Section -->
                <div class="editor-section">
                    <h3><i class="fab fa-instagram"></i> Redes Sociales</h3>
                    <p>Enlaces a redes sociales (Pinterest ser치 eliminado)</p>
                    
                    <div class="social-form">
                        <div class="form-group">
                            <label><i class="fab fa-instagram"></i> Instagram</label>
                            <input type="url" id="instagramUrl" placeholder="https://instagram.com/estudioartesana" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fab fa-facebook-f"></i> Facebook</label>
                            <input type="url" id="facebookUrl" placeholder="https://facebook.com/estudioartesana" class="form-control">
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fab fa-whatsapp"></i> WhatsApp</label>
                            <input type="tel" id="whatsappNumber" placeholder="+5212345678490" class="form-control">
                            <small>N칰mero con c칩digo de pa칤s (ej: +52...)</small>
                        </div>
                    </div>
                </div>
                
                <!-- Contact Cards Section -->
                <div class="editor-section contact-cards-section">
                    <h3><i class="fas fa-address-card"></i> Tarjetas de Contacto</h3>
                    <p>Informaci칩n que aparece en la secci칩n de contacto</p>
                    
                    <div class="contact-cards-form">
                        <div class="card-editor">
                            <h4><i class="fas fa-map-marker-alt"></i> Ubicaci칩n</h4>
                            <input type="text" id="locationText" placeholder="Ciudad de M칠xico, M칠xico" class="form-control">
                        </div>
                        
                        <div class="card-editor">
                            <h4><i class="fas fa-phone"></i> Tel칠fono</h4>
                            <input type="tel" id="phoneNumber" placeholder="+52 123 456 7890" class="form-control">
                        </div>
                        
                        <div class="card-editor">
                            <h4><i class="fas fa-envelope"></i> Email</h4>
                            <input type="email" id="contactEmail" placeholder="info@estudioartesana.com" class="form-control">
                        </div>
                        
                        <div class="card-editor">
                            <h4><i class="fas fa-clock"></i> Horarios</h4>
                            <textarea id="businessHours" class="form-control" rows="3" placeholder="Lun - Vie: 9:00 AM - 6:00 PM&#10;S치b: 10:00 AM - 4:00 PM"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="editor-actions">
                <button class="btn btn-success" onclick="loadContactInfo()">
                    <i class="fas fa-sync"></i> Cargar Datos Actuales
                </button>
                <button class="btn btn-primary" onclick="saveContactInfo()">
                    <i class="fas fa-save"></i> Guardar Cambios
                </button>
                <button class="btn btn-warning" onclick="previewChanges()">
                    <i class="fas fa-eye"></i> Vista Previa
                </button>
            </div>
        </div>

        <div id="setup" class="content-area">
            <h2>Configuraci칩n del Sistema</h2>
            <div id="setupContent">
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3>Configuraci칩n del Sistema</h3>
                    <p>Panel de configuraci칩n general del sistema</p>
                    <div style="color: #666; font-size: 14px; margin-top: 15px;">
                        <i class="fas fa-info-circle"></i> Las configuraciones avanzadas se realizan directamente en el servidor.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Nuevo/Editar Mayorista -->
    <div id="mayoristasModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="mayoristasModalTitle">游끽 Nuevo Mayorista</h2>
                <button class="modal-close" onclick="closeMayoristasModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form class="modal-form" id="mayoristasForm" onsubmit="saveMayorista(event)">
                    <input type="hidden" id="editMayoristaId" value="">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="mayoristaNombre">Nombre Completo *</label>
                            <input type="text" id="mayoristaNombre" class="form-control" required>
                            <small>Nombre completo del contacto mayorista</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="mayoristaEmail">Email *</label>
                            <input type="email" id="mayoristaEmail" class="form-control" required>
                            <small>Este email ser치 usado para el login</small>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="mayoristaEmpresa">Empresa *</label>
                            <input type="text" id="mayoristaEmpresa" class="form-control" required>
                            <small>Nombre de la empresa o negocio</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="mayoristaTelefono">Tel칠fono</label>
                            <input type="tel" id="mayoristaTelefono" class="form-control">
                            <small>Tel칠fono de contacto (opcional)</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="mayoristaPassword">Contrase침a *</label>
                        <input type="password" id="mayoristaPassword" class="form-control" required minlength="6">
                        <small>M칤nimo 6 caracteres. En edici칩n, dejar vac칤o para mantener la actual.</small>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="mayoristaDescuento">Descuento (%)</label>
                            <input type="number" id="mayoristaDescuento" class="form-control" min="0" max="50" value="20">
                            <small>Descuento por defecto (0-50%)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="mayoristaEstado">Estado</label>
                            <select id="mayoristaEstado" class="form-control">
                                <option value="active">Activo</option>
                                <option value="suspended">Suspendido</option>
                                <option value="inactive">Inactivo</option>
                            </select>
                            <small>Estado actual del mayorista</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="mayoristaNotas">Notas</label>
                        <textarea id="mayoristaNotas" class="form-control" rows="3" placeholder="Notas internas sobre el mayorista (opcional)"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" onclick="closeMayoristasModal()">Cancelar</button>
                <button type="submit" form="mayoristasForm" class="btn btn-success">
                    <i class="fas fa-save"></i> <span id="mayoristaSaveText">Crear Mayorista</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Cambio de Contrase침a -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>游댏 Cambiar Contrase침a</h2>
                <button class="modal-close" onclick="closePasswordModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>Cambio de Contrase침a:</strong> Esta acci칩n enviar치 una notificaci칩n al mayorista con su nueva contrase침a.
                </div>
                
                <form class="modal-form" id="passwordForm" onsubmit="changePassword(event)">
                    <input type="hidden" id="passwordMayoristaId" value="">
                    
                    <div class="form-group">
                        <label>Mayorista:</label>
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                            <strong id="passwordMayoristaNombre"></strong><br>
                            <small id="passwordMayoristaEmail" style="color: #666;"></small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="newPassword">Nueva Contrase침a *</label>
                        <input type="password" id="newPassword" class="form-control" required minlength="6">
                        <small>M칤nimo 6 caracteres. Ser치 enviada por email al mayorista.</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">Confirmar Contrase침a *</label>
                        <input type="password" id="confirmPassword" class="form-control" required minlength="6">
                        <small>Repite la nueva contrase침a para confirmar</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" onclick="closePasswordModal()">Cancelar</button>
                <button type="submit" form="passwordForm" class="btn btn-warning">
                    <i class="fas fa-key"></i> Cambiar Contrase침a
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;

        function checkAuth() {
            try {
                // Check if logout is in progress
                const logoutInProgress = localStorage.getItem('adminLogoutInProgress');
                if (logoutInProgress) {
                    console.log('游댃 Logout en progreso, saltando verificaci칩n de autenticaci칩n');
                    localStorage.removeItem('adminLogoutInProgress');
                    return false;
                }

                const session = localStorage.getItem('adminSession');

                // Verificar si hay intento de loop infinito
                const lastAuthCheck = localStorage.getItem('lastAuthCheck');
                const now = Date.now();

                if (lastAuthCheck && (now - parseInt(lastAuthCheck)) < 1500) {
                    console.warn('丘멆잺 Detectado posible loop de autenticaci칩n, deteniendo redirecciones');
                    localStorage.removeItem('adminSession');
                    localStorage.removeItem('lastAuthCheck');
                    // Set a flag to prevent immediate redirect loops
                    localStorage.setItem('adminAuthLoopDetected', now.toString());
                    return false;
                }

                // Check if we recently detected a loop
                const loopDetected = localStorage.getItem('adminAuthLoopDetected');
                if (loopDetected && (now - parseInt(loopDetected)) < 5000) {
                    console.warn('丘멆잺 Loop detectado recientemente, esperando antes de verificar autenticaci칩n');
                    return false;
                }

                localStorage.setItem('lastAuthCheck', now.toString());

                if (!session) {
                    console.log('游 No hay sesi칩n admin, redirigiendo a homepage');
                    setTimeout(() => {
                        window.location.replace('../index.html');
                    }, 100);
                    return false;
                }
    
                const sessionData = JSON.parse(session);
                
                if (!sessionData.isLoggedIn) {
                    console.log('游 Sesi칩n admin no v치lida (not logged in)');
                    localStorage.removeItem('adminSession');
                    setTimeout(() => {
                        window.location.replace('../index.html');
                    }, 100);
                    return false;
                }
                
                if (sessionData.expires && now > sessionData.expires) {
                    console.log('游 Sesi칩n admin expirada');
                    localStorage.removeItem('adminSession');
                    setTimeout(() => {
                        window.location.replace('../index.html');
                    }, 100);
                    return false;
                }
                
                // Sesi칩n v치lida
                currentUser = sessionData;
                updateUserInfo();
                console.log('九 Autenticaci칩n admin v치lida:', sessionData.email || sessionData.username);
                
                // Limpiar contador de verificaciones y flags de loop
                setTimeout(() => {
                    localStorage.removeItem('lastAuthCheck');
                    localStorage.removeItem('adminAuthLoopDetected');
                }, 3000);
                
                return true;
                
            } catch (error) {
                console.error('仇 Error en checkAuth:', error);
                localStorage.removeItem('adminSession');
                localStorage.removeItem('lastAuthCheck');
                localStorage.removeItem('adminAuthLoopDetected');
                setTimeout(() => {
                    window.location.replace('../index.html');
                }, 100);
                return false;
            }
        }

        function updateUserInfo() {
            if (currentUser) {
                const userEmailElement = document.getElementById('userEmail');
                userEmailElement.textContent = currentUser.email || currentUser.username || 'Admin';
            }
        }

        function showSection(sectionId) {
            document.querySelectorAll('.content-area').forEach(area => {
                area.classList.remove('active');
            });

            document.getElementById(sectionId).classList.add('active');

            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');

            const titles = {
                dashboard: 'Dashboard',
                inventory: 'Gesti칩n de Inventario',
                ventas: 'Panel de Ventas y Gesti칩n de Pedidos',
                mayoristas: 'Administraci칩n de Mayoristas',
                usuarios: 'Gesti칩n de Usuarios',
                banner: 'Editor de Banner Promocional',
                contacto: 'Editor de Informaci칩n de Contacto',
                setup: 'Configuraci칩n del Sistema'
            };
            document.getElementById('pageTitle').textContent = titles[sectionId] || 'Panel de Administraci칩n';
        }

        async function logout() {
            if (confirm('쮼st치s seguro de que quieres cerrar sesi칩n?')) {
                try {
                    console.log('游댃 Iniciando proceso de logout admin...');

                    // 1. Set logout flags to prevent auth checks during logout
                    localStorage.setItem('adminLogoutInProgress', 'true');
                    localStorage.setItem('adminRecentLogout', Date.now().toString());

                    // 2. Clear all auth-related localStorage items
                    const keysToRemove = ['adminSession', 'lastAuthCheck', 'lastLoginCheck', 'adminAuthLoopDetected'];
                    keysToRemove.forEach(key => {
                        console.log(`游딈勇 Removiendo clave: ${key}`);
                        localStorage.removeItem(key);
                    });

                    // 3. Close Supabase session if exists (with timeout)
                    if (window.supabase) {
                        try {
                            console.log('游댃 Cerrando sesi칩n de Supabase...');
                            const signOutPromise = window.supabase.auth.signOut();
                            const timeoutPromise = new Promise((resolve) => {
                                setTimeout(() => resolve({ timeout: true }), 3000);
                            });

                            const result = await Promise.race([signOutPromise, timeoutPromise]);
                            if (result?.timeout) {
                                console.warn('丘멆잺 Timeout cerrando sesi칩n de Supabase');
                            } else {
                                console.log('九 Sesi칩n de Supabase cerrada');
                            }
                        } catch (supabaseError) {
                            console.warn('丘멆잺 Error cerrando sesi칩n de Supabase:', supabaseError);
                        }
                    }

                    console.log('九 Logout completado, redirigiendo a homepage...');

                    // 4. Small delay to ensure cleanup completes, then redirect
                    setTimeout(() => {
                        window.location.replace('../index.html');
                    }, 100);

                } catch (error) {
                    console.error('仇 Error durante logout:', error);
                    // Force logout with minimal cleanup
                    localStorage.setItem('adminLogoutInProgress', 'true');
                    localStorage.setItem('adminRecentLogout', Date.now().toString());
                    localStorage.removeItem('adminSession');
                    localStorage.removeItem('lastAuthCheck');
                    localStorage.removeItem('lastLoginCheck');
                    window.location.replace('../index.html');
                }
            }
        }

        // Variables globales para inventario
        let supabase = null;
        let allProducts = [];
        let filteredProducts = [];
        let categories = [];
        let currentPage = 1;
        const itemsPerPage = 10;

        // Inicializar Supabase
        function initSupabase() {
            if (window.SUPABASE_CONFIG) {
                // Use service role key for admin operations
                supabase = window.supabase.createClient(
                    window.SUPABASE_CONFIG.url,
                    window.SUPABASE_CONFIG.serviceRoleKey
                );
                return true;
            }
            return false;
        }

        // Cargar configuraci칩n de Supabase
        function loadSupabaseConfig() {
            const script = document.createElement('script');
            script.src = '../assets/js/config.js';
            script.onload = function() {
                if (initSupabase()) {
                    console.log('九 Supabase inicializado para inventario');
                } else {
                    console.error('仇 No se pudo inicializar Supabase');
                }
            };
            document.head.appendChild(script);
        }

        // Cargar productos desde Supabase
        async function loadProducts() {
            if (!supabase) {
                showMockData();
                return;
            }

            try {
                // Opci칩n 1: Intentar con products_full primero (si tiene las categor칤as)
                let { data, error } = await supabase
                    .from('products_full')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                // Si products_full no tiene categor칤as, hacemos JOIN manual
                if (data && data.length > 0 && !data[0].category_name) {
                    console.log('products_full no tiene categor칤as, haciendo JOIN manual...');
                    
                    // Obtener productos b치sicos
                    const { data: products, error: prodError } = await supabase
                        .from('products')
                        .select('*')
                        .order('created_at', { ascending: false });
                    
                    if (prodError) {
                        console.error('Error cargando productos:', prodError);
                        showMockData();
                        return;
                    }
                    
                    // Obtener relaciones producto-categor칤a
                    const { data: productCategories, error: pcError } = await supabase
                        .from('product_categories')
                        .select('product_id, category_id');
                    
                    // Obtener todas las categor칤as
                    const { data: allCategories, error: catError } = await supabase
                        .from('categories')
                        .select('*');
                    
                    if (pcError || catError) {
                        console.log('仇 Error cargando relaciones de categor칤as');
                        data = products; // Usar productos sin categor칤as
                    } else {
                        // Combinar datos
                        data = products.map(product => {
                            // Buscar la categor칤a del producto
                            const productCategory = productCategories.find(pc => pc.product_id === product.id);
                            let categoryInfo = null;
                            
                            if (productCategory) {
                                categoryInfo = allCategories.find(cat => cat.id === productCategory.category_id);
                            }
                            
                            return {
                                ...product,
                                category_name: categoryInfo?.name || null,
                                category_id: categoryInfo?.id || null,
                                category: categoryInfo?.name || 'Sin categor칤a' // Para compatibilidad
                            };
                        });
                        
                        console.log('九 JOIN manual completado');
                    }
                }

                if (error) {
                    console.error('Error cargando productos:', error);
                    showMockData();
                    return;
                }

                allProducts = data || [];
                // Depurar los productos recibidos
                console.log('Productos cargados con categor칤as:', allProducts.slice(0, 3));
                
                filteredProducts = [...allProducts];
                renderProducts();
                updatePagination();
                
            } catch (error) {
                console.error('Error inesperado:', error);
                showMockData();
            }
        }

        // Cargar categor칤as desde Supabase
        async function loadCategories() {
            if (!supabase) {
                categories = [
                    { id: 1, name: 'Herramientas', slug: 'herramientas' },
                    { id: 2, name: 'Materiales', slug: 'materiales' },
                    { id: 3, name: 'Accesorios', slug: 'accesorios' }
                ];
                populateCategoryFilter();
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('categories')
                    .select('*')
                    .order('name');

                if (error) {
                    console.error('Error cargando categor칤as:', error);
                } else {
                    categories = data || [];
                    console.log('Categor칤as cargadas:', categories);
                }
                
                populateCategoryFilter();
            } catch (error) {
                console.error('Error cargando categor칤as:', error);
            }
        }

        // Mostrar datos de prueba si Supabase no est치 disponible
        function showMockData() {
            allProducts = [
                {
                    id: 1,
                    name: 'Martillo de Acero',
                    category: 'Herramientas',
                    price: 250.00,
                    stock: 15,
                    status: 'active',
                    image_url: 'https://via.placeholder.com/50x50?text=IMG'
                },
                {
                    id: 2,
                    name: 'Pintura Acr칤lica',
                    category: 'Materiales',
                    price: 85.50,
                    stock: 3,
                    status: 'low-stock',
                    image_url: 'https://via.placeholder.com/50x50?text=IMG'
                },
                {
                    id: 3,
                    name: 'Pinceles Set',
                    category: 'Accesorios',
                    price: 120.00,
                    stock: 0,
                    status: 'inactive',
                    image_url: 'https://via.placeholder.com/50x50?text=IMG'
                }
            ];
            filteredProducts = [...allProducts];
            renderProducts();
            updatePagination();
        }

        // Poblar filtro de categor칤as
        function populateCategoryFilter() {
            const categoryFilter = document.getElementById('categoryFilter');
            categoryFilter.innerHTML = '<option value="">Todas las categor칤as</option>';
            
            // Verificar si hay un error en los nombres de categor칤as
            categories.forEach(category => {
                const option = document.createElement('option');
                // Verificar qu칠 campos existen en cada categor칤a
                const categoryName = category.name || category.category_name || category.title || category.slug || 'Sin nombre';
                // Usar el mismo valor y texto para asegurar coincidencia
                option.value = categoryName;
                option.textContent = categoryName;
                categoryFilter.appendChild(option);
            });
        }

        // Renderizar productos en la tabla
        function renderProducts() {
            const tbody = document.getElementById('inventoryTableBody');
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const productsToShow = filteredProducts.slice(start, end);

            if (productsToShow.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="loading-row">No se encontraron productos</td></tr>';
                return;
            }

            tbody.innerHTML = productsToShow.map(product => {
                const status = getProductStatus(product);
                return `
                    <tr>
                        <td><img src="${product.image_url || 'https://via.placeholder.com/50x50?text=IMG'}" alt="${product.name}" class="product-img"></td>
                        <td><strong>${product.name}</strong></td>
                        <td>${product.category_name || product.category || 'Sin categor칤a'}</td>
                        <td>$${parseFloat(product.price || 0).toFixed(2)}</td>
                        <td>${product.stock || 0}</td>
                        <td><span class="status-badge status-${status.class}">${status.text}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn btn-warning" onclick="editProduct(${product.id})" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn btn-success" onclick="duplicateProduct(${product.id})" title="Duplicar">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button class="action-btn btn-danger" onclick="deleteProduct(${product.id})" title="Eliminar">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Obtener estado del producto
        function getProductStatus(product) {
            const stock = parseInt(product.stock || 0);
            
            if (stock === 0) {
                return { class: 'inactive', text: 'Sin Stock' };
            } else if (stock <= 5) {
                return { class: 'low-stock', text: 'Stock Bajo' };
            } else {
                return { class: 'active', text: 'Activo' };
            }
        }

        // Filtrar productos
        function filterProducts() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const searchFilter = document.getElementById('searchFilter').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;

            // Mostrar en consola los filtros activos para depuraci칩n
            console.log('Filtros aplicados:', { categoryFilter, searchFilter, statusFilter });

            filteredProducts = allProducts.filter(product => {
                // Comprobamos el nombre del campo de categor칤a
                const productCategory = product.category_name || product.category || '';
                
                const matchesCategory = !categoryFilter || 
                                       productCategory === categoryFilter || 
                                       productCategory.toLowerCase() === categoryFilter.toLowerCase();
                                       
                const matchesSearch = !searchFilter || 
                                     (product.name && product.name.toLowerCase().includes(searchFilter));
                                     
                const productStatus = getProductStatus(product);
                const matchesStatus = !statusFilter || productStatus.class === statusFilter;
                
                return matchesCategory && matchesSearch && matchesStatus;
            });

            currentPage = 1;
            renderProducts();
            updatePagination();
        }

        // Actualizar paginaci칩n
        function updatePagination() {
            const totalProducts = filteredProducts.length;
            const totalPages = Math.ceil(totalProducts / itemsPerPage);
            const start = (currentPage - 1) * itemsPerPage + 1;
            const end = Math.min(currentPage * itemsPerPage, totalProducts);

            document.getElementById('paginationInfo').textContent = `${start}-${end} de ${totalProducts}`;
            
            // Botones anterior/siguiente
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages || totalPages === 0;

            // N칰meros de p치gina
            const pageNumbers = document.getElementById('pageNumbers');
            pageNumbers.innerHTML = '';
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage || i === 1 || i === totalPages || Math.abs(i - currentPage) <= 1) {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = `btn btn-sm ${i === currentPage ? 'btn-primary' : ''}`;
                    pageBtn.textContent = i;
                    pageBtn.onclick = () => {
                        currentPage = i;
                        renderProducts();
                        updatePagination();
                    };
                    pageNumbers.appendChild(pageBtn);
                } else if (pageNumbers.lastChild && pageNumbers.lastChild.textContent !== '...') {
                    const dots = document.createElement('span');
                    dots.textContent = '...';
                    dots.style.padding = '0 5px';
                    pageNumbers.appendChild(dots);
                }
            }
        }

        // Cambiar p치gina
        function changePage(direction) {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            
            if (direction === -1 && currentPage > 1) {
                currentPage--;
            } else if (direction === 1 && currentPage < totalPages) {
                currentPage++;
            }
            
            renderProducts();
            updatePagination();
        }

        // Actualizar inventario
        function refreshInventory() {
            document.getElementById('inventoryTableBody').innerHTML = '<tr><td colspan="7" class="loading-row"><i class="fas fa-spinner fa-spin"></i> Actualizando...</td></tr>';
            setTimeout(() => {
                loadProducts();
                loadCategories();
            }, 1000);
        }

        // Funciones de acciones de producto
        function showAddProductModal() {
            alert('Funcionalidad de agregar producto - Pr칩ximamente');
        }

        function editProduct(id) {
            const product = allProducts.find(p => p.id === id);
            if (product) {
                alert(`Editar producto: ${product.name} - Pr칩ximamente`);
            }
        }

        function duplicateProduct(id) {
            const product = allProducts.find(p => p.id === id);
            if (product && confirm(`쮻uplicar producto "${product.name}"?`)) {
                alert('Funcionalidad de duplicar - Pr칩ximamente');
            }
        }

        function deleteProduct(id) {
            const product = allProducts.find(p => p.id === id);
            if (product && confirm(`쮼liminar producto "${product.name}"? Esta acci칩n no se puede deshacer.`)) {
                alert('Funcionalidad de eliminar - Pr칩ximamente');
            }
        }

        // Inicializar cuando se cambia a la secci칩n de inventario
        function initInventory() {
            if (!document.getElementById('inventory').classList.contains('active')) {
                return;
            }
            
            console.log('游닍 Inicializando inventario...');
            loadSupabaseConfig();
            setTimeout(() => {
                loadCategories();
                loadProducts();
            }, 500);
        }

        // ====== FUNCIONES PARA EDITOR DE CONTACTO ======
        
        // Cargar informaci칩n de contacto actual desde index.html
        function loadContactInfo() {
            console.log('游 Cargando informaci칩n de contacto actual...');
            
            // Datos por defecto basados en index.html actual
            const defaultData = {
                // Trust Icons
                trustIcon1Text: 'Env칤o Gratis*',
                trustIcon1Icon: 'fas fa-truck',
                trustIcon2Text: 'Hecho a Mano',
                trustIcon2Icon: 'fas fa-hand-holding-heart',
                trustIcon3Text: 'Calidad Premium',
                trustIcon3Icon: 'fas fa-shield-alt',
                shippingDisclaimer: '*En compras superiores a $2,000.00',

                // Promotional Banner
                promoDiscount: '25% OFF',

                // Social Media
                instagramUrl: '#',
                facebookUrl: '#',
                whatsappNumber: '+5212345678490',

                // Contact Cards
                locationText: 'Ciudad de M칠xico, M칠xico',
                phoneNumber: '+52 123 456 7890',
                contactEmail: 'info@estudioartesana.com',
                businessHours: 'Lun - Vie: 9:00 AM - 6:00 PM\nS치b: 10:00 AM - 4:00 PM'
            };
            
            // Llenar formulario con datos por defecto
            Object.keys(defaultData).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = defaultData[key];
                }
            });
            
            alert('九 Datos actuales cargados desde la configuraci칩n actual del sitio web');
        }
        
        // Guardar cambios - Aplicaci칩n autom치tica
        function saveContactInfo() {
            const contactData = {
                // Trust Icons
                trustIcon1Text: document.getElementById('trustIcon1Text').value,
                trustIcon1Icon: document.getElementById('trustIcon1Icon').value,
                trustIcon2Text: document.getElementById('trustIcon2Text').value,
                trustIcon2Icon: document.getElementById('trustIcon2Icon').value,
                trustIcon3Text: document.getElementById('trustIcon3Text').value,
                trustIcon3Icon: document.getElementById('trustIcon3Icon').value,
                shippingDisclaimer: document.getElementById('shippingDisclaimer').value,

                // Promotional Banner
                promoDiscount: document.getElementById('promoDiscount').value || '25% OFF',

                // Social Media
                instagramUrl: document.getElementById('instagramUrl').value,
                facebookUrl: document.getElementById('facebookUrl').value,
                whatsappNumber: document.getElementById('whatsappNumber').value,

                // Contact Cards
                locationText: document.getElementById('locationText').value,
                phoneNumber: document.getElementById('phoneNumber').value,
                contactEmail: document.getElementById('contactEmail').value,
                businessHours: document.getElementById('businessHours').value
            };
            
            // Validar campos obligatorios
            const requiredFields = ['trustIcon1Text', 'trustIcon2Text', 'trustIcon3Text', 'locationText', 'phoneNumber', 'contactEmail'];
            const missingFields = requiredFields.filter(field => !contactData[field].trim());
            
            if (missingFields.length > 0) {
                alert('仇 Por favor completa todos los campos obligatorios:\n' + missingFields.join(', '));
                return;
            }
            
            // Mostrar mensaje de confirmaci칩n
            const success = confirm(`
游 APLICAR CAMBIOS AUTOM츼TICAMENTE

游늯 RESUMEN DE CAMBIOS:

游띠勇 ELEMENTOS DE CONFIANZA:
 칈cono 1: ${contactData.trustIcon1Text}
 칈cono 2: ${contactData.trustIcon2Text}
 칈cono 3: ${contactData.trustIcon3Text}
 Descargo: ${contactData.shippingDisclaimer}

游꿢 BANNER PROMOCIONAL:
 Descuento: ${contactData.promoDiscount}

游님 REDES SOCIALES:
 Instagram: ${contactData.instagramUrl || 'Sin cambios'}
 Facebook: ${contactData.facebookUrl || 'Sin cambios'}
 WhatsApp: ${contactData.whatsappNumber}

游늸 INFORMACI칍N DE CONTACTO:
 Ubicaci칩n: ${contactData.locationText}
 Tel칠fono: ${contactData.phoneNumber}
 Email: ${contactData.contactEmail}
 Horarios: ${contactData.businessHours.replace(/\n/g, ' | ')}

九 Estos cambios se aplicar치n autom치ticamente en la p치gina de inicio.
쮺ontinuar?`);
            
            if (!success) {
                return;
            }
            
            // Guardar en localStorage
            localStorage.setItem('contactInfo', JSON.stringify(contactData));
            
            // Intentar refrescar index.html si est치 abierto en otra pesta침a
            try {
                // Disparar evento de storage para actualizaci칩n en tiempo real
                window.dispatchEvent(new StorageEvent('storage', {
                    key: 'contactInfo',
                    newValue: JSON.stringify(contactData)
                }));

                // Also dispatch custom event for footer updates
                window.dispatchEvent(new CustomEvent('contactInfoUpdated', {
                    detail: contactData
                }));
            } catch (error) {
                console.warn('No se pudo disparar evento de storage:', error);
            }
            
            // Mostrar mensaje de 칠xito
            const successMessage = `
九 춰CAMBIOS GUARDADOS EXITOSAMENTE!

游댃 Los cambios se han aplicado autom치ticamente.

游님 Si tienes la p치gina principal abierta en otra pesta침a, 
los cambios se reflejar치n inmediatamente.

游깷 Si no, simplemente recarga la p치gina principal 
para ver los cambios aplicados.

游 Los cambios han sido guardados permanentemente.`;
            
            alert(successMessage);
            
            console.log('游 九 Informaci칩n de contacto guardada y aplicada:', contactData);
        }
        
        // Vista previa de cambios
        function previewChanges() {
            const previewData = {
                trustIcon1Text: document.getElementById('trustIcon1Text').value || 'Env칤o Gratis*',
                trustIcon1Icon: document.getElementById('trustIcon1Icon').value || 'fas fa-truck',
                trustIcon2Text: document.getElementById('trustIcon2Text').value || 'Hecho a Mano',
                trustIcon2Icon: document.getElementById('trustIcon2Icon').value || 'fas fa-hand-holding-heart',
                trustIcon3Text: document.getElementById('trustIcon3Text').value || 'Calidad Premium',
                trustIcon3Icon: document.getElementById('trustIcon3Icon').value || 'fas fa-shield-alt',
                locationText: document.getElementById('locationText').value || 'Ciudad de M칠xico, M칠xico',
                phoneNumber: document.getElementById('phoneNumber').value || '+52 123 456 7890',
                contactEmail: document.getElementById('contactEmail').value || 'info@estudioartesana.com'
            };
            
            // Crear ventana de vista previa
            const previewHTML = `
                <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 600px;">
                    <h2 style="color: #2c3e50; margin-bottom: 20px;">游 Vista Previa de Cambios</h2>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="color: #495057; margin-bottom: 15px;">游띠勇 Elementos de Confianza:</h3>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 5px; background: white; padding: 8px; border-radius: 5px;">
                                <i class="${previewData.trustIcon1Icon}" style="color: #D4AF37;"></i>
                                <span>${previewData.trustIcon1Text}</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px; background: white; padding: 8px; border-radius: 5px;">
                                <i class="${previewData.trustIcon2Icon}" style="color: #D4AF37;"></i>
                                <span>${previewData.trustIcon2Text}</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px; background: white; padding: 8px; border-radius: 5px;">
                                <i class="${previewData.trustIcon3Icon}" style="color: #D4AF37;"></i>
                                <span>${previewData.trustIcon3Text}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <h3 style="color: #495057; margin-bottom: 15px;">游늸 Tarjetas de Contacto:</h3>
                        <div style="display: grid; gap: 10px;">
                            <div style="background: white; padding: 10px; border-radius: 5px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-map-marker-alt" style="color: #D4AF37; width: 20px;"></i>
                                <span>${previewData.locationText}</span>
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 5px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-phone" style="color: #D4AF37; width: 20px;"></i>
                                <span>${previewData.phoneNumber}</span>
                            </div>
                            <div style="background: white; padding: 10px; border-radius: 5px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-envelope" style="color: #D4AF37; width: 20px;"></i>
                                <span>${previewData.contactEmail}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 10px; background: #e3f2fd; border-radius: 5px; color: #1565c0;">
                        <i class="fas fa-info-circle"></i> Esta es una vista previa aproximada. Los cambios reales se ver치n en el sitio web una vez aplicados.
                    </div>
                </div>
            `;
            
            // Abrir ventana de vista previa
            const previewWindow = window.open('', 'preview', 'width=700,height=600,scrollbars=yes');
            previewWindow.document.write(previewHTML);
            previewWindow.document.head.innerHTML = '<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">';
        }
        
        // Inicializar editor de contacto cuando se activa la secci칩n
        function initContactEditor() {
            // Cargar datos guardados del localStorage si existen
            const savedData = localStorage.getItem('contactInfo');
            if (savedData) {
                try {
                    const contactData = JSON.parse(savedData);
                    Object.keys(contactData).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            element.value = contactData[key];
                        }
                    });
                    console.log('游 Datos previamente guardados cargados desde localStorage');
                } catch (error) {
                    console.error('Error al cargar datos guardados:', error);
                }
            }
        }
        
        // ====== FUNCIONES PARA PANEL DE VENTAS ======
        
        // Variables para el panel de ventas
        let salesData = {
            today: 0,
            pendingOrders: 0,
            abandonedCarts: 0,
            registeredUsers: 0
        };
        let allOrders = [];
        let allAbandonedCarts = [];
        
        // Inicializar panel de ventas
        function initSalesPanel() {
            console.log('游눯 Inicializando panel de ventas...');
            loadSalesData();
            loadOrdersData();
            loadAbandonedCartsData();
        }
        
        // Cargar datos de ventas desde Supabase
        async function loadSalesData() {
            if (!supabase) {
                console.log('丘멆잺 Supabase no disponible, mostrando datos de ejemplo');
                // Cargar configuraci칩n de Supabase si no est치 inicializado
                loadSupabaseConfig();
                updateSalesSummary();
                return;
            }
            
            try {
                // Obtener ventas del d칤a actual
                const today = new Date().toISOString().split('T')[0];
                const { data: todaySales } = await supabase
                    .from('orders')
                    .select('total')
                    .eq('status', 'paid')
                    .gte('created_at', today);
                
                salesData.today = todaySales?.reduce((sum, order) => sum + parseFloat(order.total || 0), 0) || 0;
                
                // Obtener pedidos pendientes
                const { data: pendingOrders } = await supabase
                    .from('orders')
                    .select('id')
                    .in('status', ['pending', 'processing']);
                
                salesData.pendingOrders = pendingOrders?.length || 0;
                
                // Obtener carritos abandonados
                const { data: abandonedCarts } = await supabase
                    .from('abandoned_carts')
                    .select('id')
                    .eq('is_recovered', false);
                
                salesData.abandonedCarts = abandonedCarts?.length || 0;
                
                // Obtener usuarios registrados
                const { data: users } = await supabase
                    .from('profiles')
                    .select('id');
                
                salesData.registeredUsers = users?.length || 0;
                
            } catch (error) {
                console.error('Error cargando datos de ventas:', error);
            }
            
            updateSalesSummary();
        }
        
        // Actualizar resumen de ventas en la interfaz
        function updateSalesSummary() {
            const salesElements = document.querySelectorAll('.sales-summary p');
            if (salesElements.length >= 4) {
                salesElements[0].textContent = `$${salesData.today.toFixed(2)}`;
                salesElements[1].textContent = salesData.pendingOrders;
                salesElements[2].textContent = salesData.abandonedCarts;
                salesElements[3].textContent = salesData.registeredUsers;
            }
        }
        
        // Cargar datos de pedidos
        async function loadOrdersData() {
            if (!supabase) {
                showMockOrdersData();
                return;
            }
            
            try {
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        profiles:user_id(email, full_name)
                    `)
                    .order('created_at', { ascending: false })
                    .limit(50);
                
                if (error) {
                    console.error('Error cargando pedidos:', error);
                    showMockOrdersData();
                    return;
                }
                
                allOrders = orders || [];
                renderOrdersTable();
                
            } catch (error) {
                console.error('Error inesperado cargando pedidos:', error);
                showMockOrdersData();
            }
        }
        
        // Mostrar datos de ejemplo para pedidos
        function showMockOrdersData() {
            allOrders = [];
            renderOrdersTable();
        }
        
        // Renderizar tabla de pedidos
        function renderOrdersTable() {
            const tbody = document.getElementById('ordersTableBody');
            
            if (allOrders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="loading-row">
                            <i class="fas fa-info-circle"></i> No hay pedidos para mostrar. 
                            <br><small style="color: #666;">Los pedidos aparecer치n aqu칤 una vez que los usuarios realicen compras.</small>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = allOrders.map(order => {
                const orderDate = new Date(order.created_at).toLocaleDateString();
                const customerName = order.profiles?.full_name || order.profiles?.email || 'Usuario Invitado';
                const statusBadge = getOrderStatusBadge(order.status);
                
                return `
                    <tr>
                        <td><strong>#${order.id}</strong></td>
                        <td>${customerName}</td>
                        <td>${orderDate}</td>
                        <td>$${parseFloat(order.total || 0).toFixed(2)}</td>
                        <td>${statusBadge}</td>
                        <td>${order.payment_method || 'No especificado'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn btn-primary" onclick="viewOrder(${order.id})" title="Ver Detalles">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn btn-success" onclick="updateOrderStatus(${order.id})" title="Actualizar Estado">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Obtener badge de estado de pedido
        function getOrderStatusBadge(status) {
            const statusMap = {
                'pending': { class: 'status-low-stock', text: 'Pendiente' },
                'paid': { class: 'status-active', text: 'Pagado' },
                'processing': { class: 'status-low-stock', text: 'Procesando' },
                'shipped': { class: 'status-active', text: 'Enviado' },
                'delivered': { class: 'status-active', text: 'Entregado' },
                'cancelled': { class: 'status-inactive', text: 'Cancelado' }
            };
            
            const statusInfo = statusMap[status] || { class: 'status-inactive', text: 'Desconocido' };
            return `<span class="status-badge ${statusInfo.class}">${statusInfo.text}</span>`;
        }
        
        // Cargar datos de carritos abandonados
        async function loadAbandonedCartsData() {
            if (!supabase) {
                showMockAbandonedCartsData();
                return;
            }
            
            try {
                const { data: carts, error } = await supabase
                    .from('abandoned_carts')
                    .select(`
                        *,
                        profiles:user_id(email, full_name)
                    `)
                    .order('abandoned_at', { ascending: false })
                    .limit(20);
                
                if (error) {
                    console.error('Error cargando carritos abandonados:', error);
                    showMockAbandonedCartsData();
                    return;
                }
                
                allAbandonedCarts = carts || [];
                renderAbandonedCartsTable();
                
            } catch (error) {
                console.error('Error inesperado cargando carritos abandonados:', error);
                showMockAbandonedCartsData();
            }
        }
        
        // Mostrar datos de ejemplo para carritos abandonados
        function showMockAbandonedCartsData() {
            allAbandonedCarts = [];
            renderAbandonedCartsTable();
        }
        
        // Renderizar tabla de carritos abandonados
        function renderAbandonedCartsTable() {
            const tbody = document.getElementById('abandonedCartsTableBody');
            
            if (allAbandonedCarts.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="loading-row">
                            <i class="fas fa-shopping-cart"></i> No hay carritos abandonados.
                            <br><small style="color: #666;">Los carritos abandonados aparecer치n aqu칤 cuando se detecten autom치ticamente.</small>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = allAbandonedCarts.map(cart => {
                const abandonedDate = new Date(cart.abandoned_at).toLocaleDateString();
                const customerInfo = cart.profiles?.email || cart.guest_email || 'Usuario Invitado';
                const productsCount = cart.products_data ? JSON.parse(cart.products_data).length : 0;
                const statusBadge = cart.is_recovered ? 
                    '<span class="status-badge status-active">Recuperado</span>' : 
                    '<span class="status-badge status-low-stock">Pendiente</span>';
                
                return `
                    <tr>
                        <td>${customerInfo}</td>
                        <td>${productsCount} productos</td>
                        <td>$${parseFloat(cart.cart_total || 0).toFixed(2)}</td>
                        <td>${abandonedDate}</td>
                        <td>${cart.recovery_emails_sent || 0}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn btn-primary" onclick="viewAbandonedCart(${cart.id})" title="Ver Carrito">
                                    <i class="fas fa-eye"></i>
                                </button>
                                ${!cart.is_recovered ? `
                                    <button class="action-btn btn-warning" onclick="sendRecoveryEmail(${cart.id})" title="Enviar Email">
                                        <i class="fas fa-envelope"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Actualizar datos de ventas
        function refreshSalesData() {
            console.log('游댃 Actualizando datos del panel de ventas...');
            
            // Mostrar indicadores de carga
            const salesCards = document.querySelectorAll('.sales-summary p');
            salesCards.forEach(card => {
                card.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            });
            
            setTimeout(() => {
                loadSalesData();
                loadOrdersData();
                loadAbandonedCartsData();
            }, 1000);
        }
        
        // Exportar reporte de ventas
        function exportSalesReport() {
            const reportData = {
                fecha: new Date().toLocaleDateString(),
                resumen: salesData,
                pedidos: allOrders,
                carritos_abandonados: allAbandonedCarts
            };
            
            const jsonStr = JSON.stringify(reportData, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `reporte-ventas-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
            
            alert('九 Reporte exportado exitosamente');
        }
        
        // Ver detalles de pedido
        function viewOrder(orderId) {
            const order = allOrders.find(o => o.id === orderId);
            if (order) {
                const orderDetails = `
                    游늶 DETALLES DEL PEDIDO #${order.id}
                    
                    游녻 Cliente: ${order.profiles?.full_name || order.profiles?.email || 'Usuario Invitado'}
                    游늰 Fecha: ${new Date(order.created_at).toLocaleString()}
                    游눯 Total: $${parseFloat(order.total || 0).toFixed(2)}
                    游닍 Estado: ${order.status}
                    游눱 M칠todo de Pago: ${order.payment_method || 'No especificado'}
                    
                    游닇 Notas: ${order.notes || 'Sin notas'}
                `;
                
                alert(orderDetails);
            }
        }
        
        // Actualizar estado de pedido
        function updateOrderStatus(orderId) {
            const newStatus = prompt(`Ingresa el nuevo estado para el pedido #${orderId}:\n\n pending - Pendiente\n paid - Pagado\n processing - Procesando\n shipped - Enviado\n delivered - Entregado\n cancelled - Cancelado`);
            
            if (newStatus && ['pending', 'paid', 'processing', 'shipped', 'delivered', 'cancelled'].includes(newStatus)) {
                alert(`Estado del pedido #${orderId} actualizado a: ${newStatus}\n\n游닇 Nota: En producci칩n, esto actualizar칤a la base de datos.`);
                console.log(`Actualizar pedido ${orderId} a estado: ${newStatus}`);
            } else if (newStatus) {
                alert('仇 Estado no v치lido. Por favor usa uno de los estados listados.');
            }
        }
        
        // Ver carrito abandonado
        function viewAbandonedCart(cartId) {
            const cart = allAbandonedCarts.find(c => c.id === cartId);
            if (cart) {
                const products = cart.products_data ? JSON.parse(cart.products_data) : [];
                const productsList = products.map(p => ` ${p.name} (x${p.quantity}) - $${p.price}`).join('\n');
                
                const cartDetails = `
                    游 CARRITO ABANDONADO #${cart.id}
                    
                    游녻 Cliente: ${cart.profiles?.email || cart.guest_email || 'Usuario Invitado'}
                    游늰 Abandonado: ${new Date(cart.abandoned_at).toLocaleString()}
                    游눯 Total: $${parseFloat(cart.cart_total || 0).toFixed(2)}
                    游닎 Emails Enviados: ${cart.recovery_emails_sent || 0}
                    
                    游띐勇 PRODUCTOS:
                    ${productsList || 'No hay productos'}
                `;
                
                alert(cartDetails);
            }
        }
        
        // ====== SISTEMA DE NOTIFICACIONES POR EMAIL ======
        
        // Enviar notificaci칩n de pedido completado
        async function sendOrderCompletionEmail(orderId, customerEmail, orderDetails) {
            console.log('游닎 Enviando notificaci칩n de pedido completado...');
            
            const emailData = {
                to: customerEmail,
                subject: `九 Tu pedido #${orderId} ha sido completado - Estudio Artesana`,
                template: 'order_completion',
                data: {
                    orderId: orderId,
                    customerName: orderDetails.customerName,
                    items: orderDetails.items,
                    total: orderDetails.total,
                    trackingNumber: orderDetails.trackingNumber || `WS${Date.now().toString().slice(-6)}`
                }
            };
            
            try {
                // En producci칩n, esto se conectar칤a a un servicio de email como SendGrid, Mailgun, etc.
                await simulateEmailSend(emailData);
                
                return {
                    success: true,
                    message: `Email enviado exitosamente a ${customerEmail}`
                };
            } catch (error) {
                console.error('Error enviando email:', error);
                return {
                    success: false,
                    message: `Error enviando email: ${error.message}`
                };
            }
        }
        
        // Simular env칤o de email
        async function simulateEmailSend(emailData) {
            console.log('游댃 Simulando env칤o de email...');
            console.log('Email Data:', emailData);
            
            // Simular delay de API
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // Simular 95% de 칠xito
            if (Math.random() > 0.05) {
                console.log('九 Email enviado exitosamente (simulado)');
                return true;
            } else {
                throw new Error('Servicio de email temporalmente no disponible');
            }
        }
        
        // Debitar inventario cuando se marca como entregado
        async function debitInventoryOnDelivery(orderItems) {
            console.log('游닍 Debitando inventario por pedido entregado...');
            
            try {
                for (const item of orderItems) {
                    if (supabase) {
                        // Actualizar stock en la base de datos
                        const { error } = await supabase
                            .from('products')
                            .update({
                                stock: supabase.sql`stock - ${item.quantity}`
                            })
                            .eq('id', item.productId);
                        
                        if (error) {
                            console.error(`Error actualizando stock del producto ${item.productId}:`, error);
                        } else {
                            console.log(`九 Stock actualizado para producto ${item.productId}: -${item.quantity} unidades`);
                        }
                    } else {
                        // Modo demostraci칩n
                        console.log(`游닍 (DEMO) Debitando ${item.quantity} unidades del producto: ${item.name}`);
                    }
                }
                
                return {
                    success: true,
                    message: 'Inventario actualizado exitosamente'
                };
            } catch (error) {
                console.error('Error debitando inventario:', error);
                return {
                    success: false,
                    message: `Error actualizando inventario: ${error.message}`
                };
            }
        }
        
        // Marcar pedido como entregado
        async function markOrderAsDelivered(orderId) {
            const confirmMessage = `游닍 MARCAR PEDIDO COMO ENTREGADO

쮺onfirmar que el pedido #${orderId} ha sido entregado?

九 Esto realizar치 las siguientes acciones:
 Actualizar estado del pedido a "Entregado"
 Debitar el inventario correspondiente
 Enviar email de confirmaci칩n al cliente

쮺ontinuar?`;
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            try {
                // Datos simulados del pedido (en producci칩n vendr칤a de la base de datos)
                const orderData = {
                    id: orderId,
                    customerName: 'Mar칤a Gonz치lez',
                    customerEmail: 'maria@empresa.com',
                    items: [
                        { productId: 1, name: 'Bolsa Artesanal Premium', quantity: 15, price: 360 },
                        { productId: 2, name: 'Cuaderno de Cuero Natural', quantity: 20, price: 224 }
                    ],
                    total: 8800,
                    orderDate: '2024-01-15',
                    trackingNumber: `WS${Date.now().toString().slice(-6)}`
                };
                
                // 1. Actualizar estado del pedido
                if (supabase) {
                    const { error } = await supabase
                        .from('orders')
                        .update({
                            status: 'delivered',
                            delivered_at: new Date().toISOString()
                        })
                        .eq('id', orderId);
                    
                    if (error) {
                        throw new Error(`Error actualizando estado del pedido: ${error.message}`);
                    }
                }
                
                // 2. Debitar inventario
                const inventoryResult = await debitInventoryOnDelivery(orderData.items);
                
                // 3. Enviar email de confirmaci칩n
                const emailResult = await sendOrderCompletionEmail(
                    orderId, 
                    orderData.customerEmail, 
                    orderData
                );
                
                // Mostrar resultado
                let resultMessage = `九 PEDIDO #${orderId} MARCADO COMO ENTREGADO

`;
                resultMessage += `游닍 Estado: Actualizado exitosamente
`;
                resultMessage += `游늵 Inventario: ${inventoryResult.success ? 'Actualizado' : 'Error - ' + inventoryResult.message}
`;
                resultMessage += `游닎 Email: ${emailResult.success ? 'Enviado' : 'Error - ' + emailResult.message}
`;
                
                if (inventoryResult.success && emailResult.success) {
                    resultMessage += `
游꿀 춰Proceso completado exitosamente!`;
                } else {
                    resultMessage += `
丘멆잺 Proceso completado con algunos errores.`;
                }
                
                alert(resultMessage);
                
                // Actualizar vista si es necesario
                refreshSalesData();
                
            } catch (error) {
                console.error('Error marcando pedido como entregado:', error);
                alert(`仇 Error marcando pedido como entregado: ${error.message}`);
            }
        }
        
        // Integrar bot칩n en la tabla de pedidos
        function renderOrdersTable() {
            const tbody = document.getElementById('ordersTableBody');
            
            if (allOrders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="loading-row">
                            <i class="fas fa-info-circle"></i> No hay pedidos para mostrar. 
                            <br><small style="color: #666;">Los pedidos aparecer치n aqu칤 una vez que los usuarios realicen compras.</small>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = allOrders.map(order => {
                const orderDate = new Date(order.created_at).toLocaleDateString();
                const customerName = order.profiles?.full_name || order.profiles?.email || 'Usuario Invitado';
                const statusBadge = getOrderStatusBadge(order.status);
                
                return `
                    <tr>
                        <td><strong>#${order.id}</strong></td>
                        <td>${customerName}</td>
                        <td>${orderDate}</td>
                        <td>$${parseFloat(order.total || 0).toFixed(2)}</td>
                        <td>${statusBadge}</td>
                        <td>${order.payment_method || 'No especificado'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn btn-primary" onclick="viewOrder(${order.id})" title="Ver Detalles">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn btn-success" onclick="updateOrderStatus(${order.id})" title="Actualizar Estado">
                                    <i class="fas fa-edit"></i>
                                </button>
                                ${order.status !== 'delivered' ? `
                                    <button class="action-btn btn-warning" onclick="markOrderAsDelivered(${order.id})" title="Marcar como Entregado">
                                        <i class="fas fa-truck"></i>
                                    </button>
                                ` : `
                                    <button class="action-btn btn-secondary" title="Ya Entregado" disabled>
                                        <i class="fas fa-check"></i>
                                    </button>
                                `}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Enviar email de recuperaci칩n
        function sendRecoveryEmail(cartId) {
            if (confirm(`쮼nviar email de recuperaci칩n para el carrito #${cartId}?`)) {
                alert(`九 Email de recuperaci칩n enviado para el carrito #${cartId}\n\n游닇 Nota: En producci칩n, esto enviar칤a un email real con cup칩n de descuento.`);
                console.log(`Enviar email de recuperaci칩n para carrito ${cartId}`);
                
                // Simular incremento del contador
                const cart = allAbandonedCarts.find(c => c.id === cartId);
                if (cart) {
                    cart.recovery_emails_sent = (cart.recovery_emails_sent || 0) + 1;
                    renderAbandonedCartsTable();
                }
            }
        }
        
        // Actualizar configuraci칩n de recuperaci칩n
        function updateRecoverySettings() {
            alert('丘뙖잺 Configuraci칩n de recuperaci칩n actualizada\n\n游닇 Nota: En producci칩n, esto actualizar칤a la configuraci칩n del sistema de recuperaci칩n autom치tica.');
            console.log('Actualizar configuraci칩n de recuperaci칩n');
        }
        
        // ====== FUNCIONES PARA GESTI칍N DE MAYORISTAS ======
        
        // Variables globales para mayoristas
        let allMayoristas = [];
        let filteredMayoristas = [];
        let mayoristasData = {
            active: 0,
            suspended: 0,
            monthlyOrders: 0,
            wholesaleSales: 0
        };
        
        // Inicializar gesti칩n de mayoristas
        function initMayoristasPanel() {
            console.log('游논 Inicializando panel de mayoristas...');
            loadMayoristasData();
            updateMayoristasSummary();
        }
        
        // Cargar datos de mayoristas
        async function loadMayoristasData() {
            if (!supabase) {
                console.log('丘멆잺 Supabase no disponible, inicializando...');
                loadSupabaseConfig();
                // Wait for config to load, then retry
                setTimeout(() => {
                    if (supabase) {
                        loadMayoristasData();
                    } else {
                        showMockMayoristasData();
                    }
                }, 1000);
                return;
            }
            
            try {
                const { data: mayoristas, error } = await supabase
                    .from('wholesalers')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('Error cargando mayoristas:', error);
                    showMockMayoristasData();
                    return;
                }
                
                allMayoristas = mayoristas || [];
                filteredMayoristas = [...allMayoristas];
                
                // Calcular estad칤sticas
                mayoristasData.active = allMayoristas.filter(m => m.status === 'active').length;
                mayoristasData.suspended = allMayoristas.filter(m => m.status === 'suspended').length;
                
                renderMayoristasTable();
                updateMayoristasSummary();
                
            } catch (error) {
                console.error('Error inesperado cargando mayoristas:', error);
                showMockMayoristasData();
            }
        }
        
        // Initialize empty mayoristas data
        function showMockMayoristasData() {
            console.log('丘멆잺 No se pudo conectar con la base de datos. Mostrando interfaz vac칤a.');
            allMayoristas = [];
            filteredMayoristas = [];

            // Reset all stats to 0
            mayoristasData.active = 0;
            mayoristasData.suspended = 0;
            mayoristasData.monthlyOrders = 0;
            mayoristasData.wholesaleSales = 0.00;

            renderMayoristasTable();
            updateMayoristasSummary();
        }
        
        // Actualizar resumen de mayoristas
        function updateMayoristasSummary() {
            document.getElementById('activeMayoristasCount').textContent = mayoristasData.active;
            document.getElementById('suspendedMayoristasCount').textContent = mayoristasData.suspended;
            document.getElementById('monthlyOrdersCount').textContent = mayoristasData.monthlyOrders;
            document.getElementById('wholesaleSalesAmount').textContent = `$${mayoristasData.wholesaleSales.toFixed(2)}`;
        }
        
        // Renderizar tabla de mayoristas
        function renderMayoristasTable() {
            const tbody = document.getElementById('mayoristasTableBody');
            
            if (filteredMayoristas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="loading-row">
                            <i class="fas fa-users-cog"></i> No se encontraron mayoristas.
                            <br><small style="color: #666;">Los mayoristas aparecer치n aqu칤 una vez que se registren en el sistema.</small>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredMayoristas.map(mayorista => {
                const registerDate = new Date(mayorista.created_at).toLocaleDateString();
                const statusBadge = getMayoristaStatusBadge(mayorista.status);
                const ordersCount = Math.floor(Math.random() * 20) + 1; // Simulado
                
                return `
                    <tr>
                        <td><strong>${mayorista.name}</strong></td>
                        <td>${mayorista.email}</td>
                        <td>${mayorista.company}</td>
                        <td>${registerDate}</td>
                        <td>${statusBadge}</td>
                        <td>${ordersCount}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn btn-primary" onclick="viewMayorista(${mayorista.id})" title="Ver Detalles">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn btn-warning" onclick="editMayorista(${mayorista.id})" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn btn-success" onclick="showPasswordModal(${mayorista.id})" title="Cambiar Contrase침a">
                                    <i class="fas fa-key"></i>
                                </button>
                                ${mayorista.status === 'active' ? `
                                    <button class="action-btn btn-danger" onclick="suspendMayorista(${mayorista.id})" title="Suspender">
                                        <i class="fas fa-ban"></i>
                                    </button>
                                ` : `
                                    <button class="action-btn btn-success" onclick="activateMayorista(${mayorista.id})" title="Activar">
                                        <i class="fas fa-check"></i>
                                    </button>
                                `}
                                <button class="action-btn btn-danger" onclick="deleteMayorista(${mayorista.id})" title="Eliminar">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Obtener badge de estado de mayorista
        function getMayoristaStatusBadge(status) {
            const statusMap = {
                'active': { class: 'status-active', text: 'Activo' },
                'suspended': { class: 'status-low-stock', text: 'Suspendido' },
                'inactive': { class: 'status-inactive', text: 'Inactivo' }
            };
            
            const statusInfo = statusMap[status] || { class: 'status-inactive', text: 'Desconocido' };
            return `<span class="status-badge ${statusInfo.class}">${statusInfo.text}</span>`;
        }
        
        // Filtrar mayoristas
        function filterMayoristas() {
            const statusFilter = document.getElementById('mayoristasStatusFilter').value;
            const searchFilter = document.getElementById('mayoristasSearchFilter').value.toLowerCase();
            
            filteredMayoristas = allMayoristas.filter(mayorista => {
                const matchesStatus = !statusFilter || mayorista.status === statusFilter;
                const matchesSearch = !searchFilter || 
                                     mayorista.name.toLowerCase().includes(searchFilter) ||
                                     mayorista.email.toLowerCase().includes(searchFilter) ||
                                     mayorista.company.toLowerCase().includes(searchFilter);
                
                return matchesStatus && matchesSearch;
            });
            
            renderMayoristasTable();
        }
        
        // Actualizar datos de mayoristas
        function refreshMayoristasData() {
            console.log('游댃 Actualizando datos de mayoristas...');
            
            // Mostrar indicador de carga
            const tbody = document.getElementById('mayoristasTableBody');
            tbody.innerHTML = '<tr><td colspan="7" class="loading-row"><i class="fas fa-spinner fa-spin"></i> Actualizando...</td></tr>';
            
            setTimeout(() => {
                loadMayoristasData();
            }, 1000);
        }
        
        // ====== MODAL FUNCTIONS ======
        
        // Mostrar modal para nuevo mayorista
        function showAddMayoristaModal() {
            console.log('游댃 Abriendo modal de nuevo mayorista...');
            try {
                document.getElementById('mayoristasModalTitle').textContent = '游끽 Nuevo Mayorista';
                document.getElementById('mayoristaSaveText').textContent = 'Crear Mayorista';
                document.getElementById('editMayoristaId').value = '';

                // Limpiar formulario
                document.getElementById('mayoristasForm').reset();
                document.getElementById('mayoristaDescuento').value = 20;
                document.getElementById('mayoristaEstado').value = 'active';
                document.getElementById('mayoristaPassword').required = true;

                const modal = document.getElementById('mayoristasModal');
                if (modal) {
                    modal.classList.add('show');
                    console.log('九 Modal abierto correctamente');
                } else {
                    console.error('仇 Modal no encontrado');
                }
            } catch (error) {
                console.error('仇 Error abriendo modal:', error);
                alert('Error abriendo el formulario: ' + error.message);
            }
        }
        
        // Editar mayorista
        function editMayorista(id) {
            console.log('游댃 Editando mayorista ID:', id);
            try {
                const mayorista = allMayoristas.find(m => m.id === id);
                if (!mayorista) {
                    console.error('仇 Mayorista no encontrado:', id);
                    alert('Mayorista no encontrado');
                    return;
                }

                document.getElementById('mayoristasModalTitle').textContent = '九勇 Editar Mayorista';
                document.getElementById('mayoristaSaveText').textContent = 'Guardar Cambios';
                document.getElementById('editMayoristaId').value = id;

                // Llenar formulario
                document.getElementById('mayoristaNombre').value = mayorista.name;
                document.getElementById('mayoristaEmail').value = mayorista.email;
                document.getElementById('mayoristaEmpresa').value = mayorista.company;
                document.getElementById('mayoristaTelefono').value = mayorista.phone || '';
                document.getElementById('mayoristaDescuento').value = mayorista.discount_percentage || 20;
                document.getElementById('mayoristaEstado').value = mayorista.status;
                document.getElementById('mayoristaNotas').value = mayorista.notes || '';
                document.getElementById('mayoristaPassword').value = '';
                document.getElementById('mayoristaPassword').required = false;

                const modal = document.getElementById('mayoristasModal');
                if (modal) {
                    modal.classList.add('show');
                    console.log('九 Modal de edici칩n abierto correctamente');
                } else {
                    console.error('仇 Modal no encontrado');
                }
            } catch (error) {
                console.error('仇 Error editando mayorista:', error);
                alert('Error abriendo el formulario de edici칩n: ' + error.message);
            }
        }
        
        // Cerrar modal de mayoristas
        function closeMayoristasModal() {
            console.log('游댃 Cerrando modal de mayoristas...');
            try {
                const modal = document.getElementById('mayoristasModal');
                if (modal) {
                    modal.classList.remove('show');
                    console.log('九 Modal cerrado correctamente');
                } else {
                    console.error('仇 Modal no encontrado para cerrar');
                }
            } catch (error) {
                console.error('仇 Error cerrando modal:', error);
            }
        }
        
        // Guardar mayorista
        async function saveMayorista(event) {
            event.preventDefault();
            console.log('游댃 Saving mayorista...');

            const formData = {
                name: document.getElementById('mayoristaNombre').value,
                email: document.getElementById('mayoristaEmail').value,
                company: document.getElementById('mayoristaEmpresa').value,
                phone: document.getElementById('mayoristaTelefono').value,
                password: document.getElementById('mayoristaPassword').value,
                discount_percentage: parseInt(document.getElementById('mayoristaDescuento').value),
                status: document.getElementById('mayoristaEstado').value,
                notes: document.getElementById('mayoristaNotas').value
            };

            console.log('游늶 Form data collected:', formData);
            
            const editId = document.getElementById('editMayoristaId').value;
            const isEdit = editId !== '';
            
            try {
                if (!supabase) {
                    throw new Error('Supabase not initialized. Check your configuration.');
                }

                console.log('九勇 Edit mode:', isEdit, 'ID:', editId);
                let result;

                if (isEdit) {
                    // Actualizar mayorista existente
                    const updateData = { ...formData };
                    if (!updateData.password) {
                        delete updateData.password; // No actualizar contrase침a si est치 vac칤a
                        console.log('游댐 Password empty, not updating');
                    } else {
                        // Hash password for demo (in production use proper bcrypt)
                        updateData.password = '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi';
                    }

                    console.log('游댃 Updating mayorista with data:', updateData);
                    result = await supabase
                        .from('wholesalers')
                        .update(updateData)
                        .eq('id', editId)
                        .select(); // Return updated data
                } else {
                    // Crear nuevo mayorista
                    if (formData.password) {
                        // Hash password for demo (in production use proper bcrypt)
                        formData.password = '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi';
                    }

                    console.log('游 Creating new mayorista with data:', formData);
                    result = await supabase
                        .from('wholesalers')
                        .insert([formData])
                        .select(); // Return created data
                }

                console.log('游닋 Supabase operation result:', result);

                if (result.error) {
                    console.error('仇 Supabase error:', result.error);
                    throw result.error;
                }

                // 칄xito
                const message = `九 Mayorista ${isEdit ? 'actualizado' : 'creado'} exitosamente`;
                console.log(message);
                alert(message);

                // Cerrar modal y actualizar tabla
                closeMayoristasModal();
                await loadMayoristasData(); // Wait for data reload
                
            } catch (error) {
                console.error('Error guardando mayorista:', error);
                alert(`仇 Error al ${isEdit ? 'actualizar' : 'crear'} mayorista: ${error.message}`);
            }
        }
        
        // Ver detalles de mayorista
        function viewMayorista(id) {
            const mayorista = allMayoristas.find(m => m.id === id);
            if (!mayorista) return;
            
            const details = `
                游녻 DETALLES DEL MAYORISTA
                
                游끽 Empresa: ${mayorista.company}
                游녿꽳눺 Contacto: ${mayorista.name}
                游닎 Email: ${mayorista.email}
                游 Tel칠fono: ${mayorista.phone || 'No especificado'}
                游낑勇 Descuento: ${mayorista.discount_percentage || 20}%
                游늵 Estado: ${mayorista.status}
                游늰 Registrado: ${new Date(mayorista.created_at).toLocaleDateString()}
                
                游닇 Notas: ${mayorista.notes || 'Sin notas'}
            `;
            
            alert(details);
        }
        
        // Suspender mayorista
        async function suspendMayorista(id) {
            const mayorista = allMayoristas.find(m => m.id === id);
            if (!mayorista) return;
            
            if (!confirm(`쯉uspender al mayorista "${mayorista.name}" de "${mayorista.company}"?\n\nEsto impedir치 que realice nuevos pedidos.`)) {
                return;
            }
            
            await updateMayoristaStatus(id, 'suspended');
        }
        
        // Activar mayorista
        async function activateMayorista(id) {
            const mayorista = allMayoristas.find(m => m.id === id);
            if (!mayorista) return;
            
            if (!confirm(`쮸ctivar al mayorista "${mayorista.name}" de "${mayorista.company}"?`)) {
                return;
            }
            
            await updateMayoristaStatus(id, 'active');
        }
        
        // Actualizar estado de mayorista
        async function updateMayoristaStatus(id, newStatus) {
            try {
                if (supabase) {
                    const { error } = await supabase
                        .from('wholesalers')
                        .update({ status: newStatus })
                        .eq('id', id);
                    
                    if (error) throw error;
                } else {
                    // Modo demostraci칩n
                    const mayorista = allMayoristas.find(m => m.id === id);
                    if (mayorista) {
                        mayorista.status = newStatus;
                    }
                }
                
                alert(`九 Estado del mayorista actualizado a: ${newStatus}`);
                loadMayoristasData();
                
            } catch (error) {
                console.error('Error actualizando estado:', error);
                alert(`仇 Error al actualizar estado: ${error.message}`);
            }
        }
        
        // Eliminar mayorista
        async function deleteMayorista(id) {
            console.log('游딈勇 Deleting mayorista ID:', id);

            const mayorista = allMayoristas.find(m => m.id == id);
            if (!mayorista) {
                console.error('仇 Mayorista not found:', id);
                alert('Error: Mayorista no encontrado');
                return;
            }

            console.log('游댌 Found mayorista to delete:', mayorista);
            
            const confirmMsg = `丘멆잺 ELIMINAR MAYORISTA\n\n쮼st치s seguro de que quieres eliminar al mayorista:\n\n游녻 ${mayorista.name}\n游끽 ${mayorista.company}\n游닎 ${mayorista.email}\n\n仇 Esta acci칩n NO SE PUEDE DESHACER.\n\n쮺ontinuar?`;
            
            if (!confirm(confirmMsg)) {
                return;
            }
            
            try {
                if (!supabase) {
                    throw new Error('Supabase not initialized');
                }

                console.log('游댃 Executing delete operation...');
                const { error } = await supabase
                    .from('wholesalers')
                    .delete()
                    .eq('id', id);

                if (error) {
                    console.error('仇 Supabase delete error:', error);
                    throw error;
                }

                console.log('九 Delete successful');
                alert('九 Mayorista eliminado exitosamente');

                // Reload data to reflect changes
                await loadMayoristasData();
                
            } catch (error) {
                console.error('Error eliminando mayorista:', error);
                alert(`仇 Error al eliminar mayorista: ${error.message}`);
            }
        }
        
        // ====== PASSWORD MODAL FUNCTIONS ======
        
        // Mostrar modal de cambio de contrase침a
        function showPasswordModal(id) {
            const mayorista = allMayoristas.find(m => m.id === id);
            if (!mayorista) return;
            
            document.getElementById('passwordMayoristaId').value = id;
            document.getElementById('passwordMayoristaNombre').textContent = mayorista.name;
            document.getElementById('passwordMayoristaEmail').textContent = mayorista.email;
            
            // Limpiar campos
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            document.getElementById('passwordModal').classList.add('show');
        }
        
        // Cerrar modal de contrase침a
        function closePasswordModal() {
            document.getElementById('passwordModal').classList.remove('show');
        }
        
        // Cambiar contrase침a
        async function changePassword(event) {
            event.preventDefault();
            
            const id = document.getElementById('passwordMayoristaId').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Validar contrase침as
            if (newPassword !== confirmPassword) {
                alert('仇 Las contrase침as no coinciden');
                return;
            }
            
            if (newPassword.length < 6) {
                alert('仇 La contrase침a debe tener al menos 6 caracteres');
                return;
            }
            
            try {
                if (supabase) {
                    const { error } = await supabase
                        .from('wholesalers')
                        .update({ password: newPassword })
                        .eq('id', id);
                    
                    if (error) throw error;
                }
                
                const mayorista = allMayoristas.find(m => m.id == id);
                
                alert(`九 Contrase침a actualizada exitosamente para ${mayorista.name}\n\n游닎 Se ha enviado una notificaci칩n al email: ${mayorista.email}\n\n(En producci칩n se enviar칤a un email real)`);
                closePasswordModal();
                
            } catch (error) {
                console.error('Error cambiando contrase침a:', error);
                alert(`仇 Error al cambiar contrase침a: ${error.message}`);
            }
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkAuth()) return;

            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    const sectionId = this.dataset.section;
                    
                    // Si tiene data-section, manejar como secci칩n interna
                    if (sectionId) {
                        e.preventDefault();
                        showSection(sectionId);
                        if (sectionId === 'inventory') {
                            setTimeout(initInventory, 100);
                        } else if (sectionId === 'contacto') {
                            setTimeout(initContactEditor, 100);
                        } else if (sectionId === 'ventas') {
                            setTimeout(initSalesPanel, 100);
                        } else if (sectionId === 'mayoristas') {
                            setTimeout(initMayoristasPanel, 100);
                        }
                    }
                    // Si no tiene data-section pero tiene href, permitir navegaci칩n normal
                    // (como el caso del inventario que va a inventario.html)
                });
            });
            
            // Cerrar modales al hacer clic fuera
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.classList.remove('show');
                }
            });
        });

        // ================================================
        // USER MANAGEMENT FUNCTIONS
        // ================================================

        let allUsers = [];
        let filteredUsers = [];
        let currentUserPage = 1;
        let usersPerPage = 10;

        // Initialize user management panel
        async function initUsersPanel() {
            console.log('游댃 Initializing users panel...');
            try {
                await loadUsers();
                updateUserStats();
                setupUserEventListeners();
            } catch (error) {
                console.error('仇 Error initializing users panel:', error);
                showError('Error cargando usuarios: ' + error.message);
            }
        }

        // Setup event listeners
        function setupUserEventListeners() {
            const searchInput = document.getElementById('userSearchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchUsers();
                    }
                });
            }
        }

        // Load users from database
        async function loadUsers() {
            try {
                const { data: users, error } = await supabase
                    .from('user_profiles')
                    .select('id, email, full_name, phone, role, is_active, created_at, last_login, city, state, country')
                    .eq('role', 'Usuario')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                allUsers = users || [];
                filteredUsers = [...allUsers];
                renderUsersTable();
                console.log(`九 Loaded ${allUsers.length} users`);
            } catch (error) {
                console.error('仇 Error loading users:', error);
                const tbody = document.getElementById('usersTableBody');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="8" class="text-center">Error cargando usuarios</td></tr>';
                }
            }
        }

        // Render users table
        function renderUsersTable() {
            const tbody = document.getElementById('usersTableBody');
            if (!tbody) return;

            const startIndex = (currentUserPage - 1) * usersPerPage;
            const endIndex = startIndex + usersPerPage;
            const usersToShow = filteredUsers.slice(startIndex, endIndex);

            if (usersToShow.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center">No se encontraron usuarios</td></tr>';
                updateUsersPagination();
                return;
            }

            tbody.innerHTML = usersToShow.map(user => `
                <tr>
                    <td>
                        <div class="user-info">
                            <strong>${user.full_name || 'Sin nombre'}</strong>
                            <small style="color: #666; display: block;">
                                ${user.city ? `${user.city}, ${user.state || ''}` : 'Ubicaci칩n no especificada'}
                            </small>
                        </div>
                    </td>
                    <td>${user.email}</td>
                    <td>${user.phone || 'No especificado'}</td>
                    <td>
                        <span class="status-badge status-${user.is_active ? 'success' : 'danger'}">
                            ${user.is_active ? 'Activo' : 'Inactivo'}
                        </span>
                    </td>
                    <td>${new Date(user.created_at).toLocaleDateString('es-ES')}</td>
                    <td><span class="order-count">0</span></td>
                    <td>${user.last_login ? new Date(user.last_login).toLocaleDateString('es-ES') : 'Nunca'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn btn-info" onclick="viewUser('${user.id}')" title="Ver detalles">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn btn-warning" onclick="editUser('${user.id}')" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn ${user.is_active ? 'btn-danger' : 'btn-success'}"
                                    onclick="toggleUserStatus('${user.id}')"
                                    title="${user.is_active ? 'Suspender' : 'Activar'}">
                                <i class="fas ${user.is_active ? 'fa-user-slash' : 'fa-user-check'}"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            updateUsersPagination();
        }

        // Update user statistics
        function updateUserStats() {
            const totalUsers = allUsers.length;
            const activeUsers = allUsers.filter(u => u.is_active).length;
            const inactiveUsers = totalUsers - activeUsers;

            const elements = {
                totalUsers: document.getElementById('totalUsers'),
                activeUsers: document.getElementById('activeUsers'),
                usersWithOrders: document.getElementById('usersWithOrders'),
                inactiveUsers: document.getElementById('inactiveUsers')
            };

            if (elements.totalUsers) elements.totalUsers.textContent = totalUsers;
            if (elements.activeUsers) elements.activeUsers.textContent = activeUsers;
            if (elements.usersWithOrders) elements.usersWithOrders.textContent = '0'; // TODO: Implement
            if (elements.inactiveUsers) elements.inactiveUsers.textContent = inactiveUsers;
        }

        // Search users
        function searchUsers() {
            const searchInput = document.getElementById('userSearchInput');
            if (!searchInput) return;

            const searchTerm = searchInput.value.toLowerCase().trim();
            filteredUsers = searchTerm
                ? allUsers.filter(user =>
                    user.full_name?.toLowerCase().includes(searchTerm) ||
                    user.email?.toLowerCase().includes(searchTerm) ||
                    user.phone?.includes(searchTerm))
                : [...allUsers];

            currentUserPage = 1;
            renderUsersTable();
        }

        // Filter users
        function filterUsers() {
            const statusFilter = document.getElementById('userStatusFilter')?.value;
            const registrationFilter = document.getElementById('userRegistrationFilter')?.value;

            filteredUsers = allUsers.filter(user => {
                if (statusFilter === 'active' && !user.is_active) return false;
                if (statusFilter === 'inactive' && user.is_active) return false;

                if (registrationFilter) {
                    const createdDate = new Date(user.created_at);
                    const now = new Date();

                    switch (registrationFilter) {
                        case 'today':
                            return createdDate.toDateString() === now.toDateString();
                        case 'week':
                            return createdDate >= new Date(now - 7 * 24 * 60 * 60 * 1000);
                        case 'month':
                            return createdDate >= new Date(now - 30 * 24 * 60 * 60 * 1000);
                        case 'year':
                            return createdDate >= new Date(now - 365 * 24 * 60 * 60 * 1000);
                    }
                }
                return true;
            });

            currentUserPage = 1;
            renderUsersTable();
        }

        // Update pagination
        function updateUsersPagination() {
            const totalUsers = filteredUsers.length;
            const totalPages = Math.ceil(totalUsers / usersPerPage);
            const startIndex = (currentUserPage - 1) * usersPerPage;
            const endIndex = Math.min(startIndex + usersPerPage, totalUsers);

            const elements = {
                showing: document.getElementById('usersShowing'),
                total: document.getElementById('usersTotal'),
                pageInfo: document.getElementById('usersPageInfo'),
                prevBtn: document.getElementById('usersPrevBtn'),
                nextBtn: document.getElementById('usersNextBtn')
            };

            if (elements.showing) elements.showing.textContent = totalUsers > 0 ? endIndex : 0;
            if (elements.total) elements.total.textContent = totalUsers;
            if (elements.pageInfo) elements.pageInfo.textContent = `P치gina ${currentUserPage} de ${Math.max(1, totalPages)}`;
            if (elements.prevBtn) elements.prevBtn.disabled = currentUserPage <= 1;
            if (elements.nextBtn) elements.nextBtn.disabled = currentUserPage >= totalPages;
        }

        // Change page
        function changePage(direction) {
            const totalPages = Math.ceil(filteredUsers.length / usersPerPage);
            const newPage = currentUserPage + direction;

            if (newPage >= 1 && newPage <= totalPages) {
                currentUserPage = newPage;
                renderUsersTable();
            }
        }

        // View user details
        function viewUser(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) {
                showError('Usuario no encontrado');
                return;
            }

            alert(`游녻 DETALLES DEL USUARIO

游닎 Email: ${user.email}
游녻 Nombre: ${user.full_name || 'No especificado'}
游님 Tel칠fono: ${user.phone || 'No especificado'}
游늸 Ubicaci칩n: ${user.city ? `${user.city}, ${user.state || ''}` : 'No especificada'}
游늰 Registrado: ${new Date(user.created_at).toLocaleDateString('es-ES')}
游댃 Estado: ${user.is_active ? 'Activo' : 'Inactivo'}

좶잺 Modal completo pr칩ximamente...`);
        }

        // Edit user
        async function editUser(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;

            const newName = prompt(`Editar nombre:\n\nActual: ${user.full_name || 'Sin nombre'}`, user.full_name || '');
            if (newName === null) return;

            try {
                const { error } = await supabase
                    .from('user_profiles')
                    .update({ full_name: newName.trim(), updated_at: new Date().toISOString() })
                    .eq('id', userId);

                if (error) throw error;
                showSuccess('Usuario actualizado correctamente');
                await refreshUsers();
            } catch (error) {
                console.error('仇 Error updating user:', error);
                showError('Error: ' + error.message);
            }
        }

        // Toggle user status
        async function toggleUserStatus(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;

            const newStatus = !user.is_active;
            const action = newStatus ? 'activar' : 'suspender';

            if (!confirm(`${action.charAt(0).toUpperCase() + action.slice(1)} a ${user.full_name || user.email}?`)) return;

            try {
                const { error } = await supabase
                    .from('user_profiles')
                    .update({ is_active: newStatus, updated_at: new Date().toISOString() })
                    .eq('id', userId);

                if (error) throw error;
                showSuccess(`Usuario ${newStatus ? 'activado' : 'suspendido'} correctamente`);
                await refreshUsers();
            } catch (error) {
                console.error('仇 Error updating status:', error);
                showError('Error: ' + error.message);
            }
        }

        // Refresh users
        async function refreshUsers() {
            await loadUsers();
            updateUserStats();
        }

        // Export users
        function exportUsers() {
            const csvContent = "data:text/csv;charset=utf-8,"
                + "Email,Nombre,Tel칠fono,Estado,Registrado,Ciudad,Pa칤s\\n"
                + allUsers.map(user => [
                    user.email, user.full_name || '', user.phone || '',
                    user.is_active ? 'Activo' : 'Inactivo',
                    new Date(user.created_at).toLocaleDateString('es-ES'),
                    user.city || '', user.country || ''
                ].join(',')).join('\\n');

            const link = document.createElement("a");
            link.href = encodeURI(csvContent);
            link.download = `usuarios-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showSuccess('Usuarios exportados');
        }

        // Enhance showSection to handle users
        const originalShowSection = window.showSection;
        window.showSection = function(sectionId) {
            if (originalShowSection) originalShowSection(sectionId);
            if (sectionId === 'usuarios') setTimeout(initUsersPanel, 100);
        };
    </script>
</body>
</html>
