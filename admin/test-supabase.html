<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Supabase Connection</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
            margin: 0 auto;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Test de Conexi√≥n Supabase</h1>
        <div id="results"></div>
        <button onclick="testConnection()">Probar Conexi√≥n</button>
        <button onclick="testAdminTable()">Test Tabla Admin</button>
        <button onclick="createAdminUser()">Crear Usuario Admin</button>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // Configuraci√≥n de Supabase
        const SUPABASE_URL = 'https://yrmfrfpyqctvwyhrhivl.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlybWZyZnB5cWN0dnd5aHJoaXZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NTg5MzUsImV4cCI6MjA3MzUzNDkzNX0.qEijwK3FlnqXP2qw0gl438Tt-Rd1vrfts1cXslUuteU';
        
        // Crear cliente Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        async function testConnection() {
            addResult('üîÑ Probando conexi√≥n b√°sica a Supabase...', 'info');
            
            try {
                // Test b√°sico de conectividad
                const { data, error } = await supabase
                    .from('admin')
                    .select('*')
                    .limit(1);

                if (error) {
                    addResult(`‚ùå Error de conexi√≥n: ${error.message}`, 'error');
                    addResult(`<pre>Detalles del error:\n${JSON.stringify(error, null, 2)}</pre>`, 'error');
                } else {
                    addResult('‚úÖ Conexi√≥n exitosa a Supabase', 'success');
                    addResult(`<pre>Respuesta:\n${JSON.stringify(data, null, 2)}</pre>`, 'success');
                }
            } catch (err) {
                addResult(`‚ùå Error de JavaScript: ${err.message}`, 'error');
                console.error('Error:', err);
            }
        }

        async function testAdminTable() {
            addResult('üîÑ Probando acceso a tabla admin...', 'info');
            
            try {
                // Intentar obtener estructura de la tabla
                const { data, error } = await supabase
                    .from('admin')
                    .select('*');

                if (error) {
                    if (error.message.includes('does not exist')) {
                        addResult('‚ö†Ô∏è La tabla "admin" no existe. Necesita ser creada.', 'error');
                        addResult('SQL para crear la tabla:<br><pre>CREATE TABLE admin (\n  id SERIAL PRIMARY KEY,\n  username VARCHAR(50) UNIQUE NOT NULL,\n  password VARCHAR(255) NOT NULL,\n  created_at TIMESTAMP DEFAULT NOW()\n);</pre>', 'info');
                    } else {
                        addResult(`‚ùå Error accediendo tabla admin: ${error.message}`, 'error');
                    }
                } else {
                    addResult(`‚úÖ Tabla admin accesible. ${data.length} registros encontrados.`, 'success');
                    if (data.length > 0) {
                        addResult(`<pre>Datos de la tabla:\n${JSON.stringify(data, null, 2)}</pre>`, 'info');
                    }
                }
            } catch (err) {
                addResult(`‚ùå Error: ${err.message}`, 'error');
            }
        }

        async function createAdminUser() {
            addResult('üîÑ Intentando crear usuario admin...', 'info');
            
            try {
                const { data, error } = await supabase
                    .from('admin')
                    .insert([
                        { username: 'admin', password: 'admin123' }
                    ])
                    .select();

                if (error) {
                    addResult(`‚ùå Error creando usuario: ${error.message}`, 'error');
                    if (error.message.includes('duplicate')) {
                        addResult('‚ÑπÔ∏è El usuario "admin" ya existe.', 'info');
                    }
                } else {
                    addResult('‚úÖ Usuario admin creado exitosamente', 'success');
                    addResult(`<pre>Usuario creado:\n${JSON.stringify(data, null, 2)}</pre>`, 'success');
                }
            } catch (err) {
                addResult(`‚ùå Error: ${err.message}`, 'error');
            }
        }

        // Test autom√°tico al cargar
        window.addEventListener('load', function() {
            addResult('üöÄ P√°gina cargada. Listo para pruebas.', 'info');
            addResult(`<pre>Config Supabase:\nURL: ${SUPABASE_URL}\nAnon Key: ${SUPABASE_ANON_KEY.substring(0, 20)}...</pre>`, 'info');
        });
    </script>
</body>
</html>
