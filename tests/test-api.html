<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API - Estudio Artesana</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .loading { color: orange; }
        .success { color: green; }
        .error { color: red; }
        .category-item { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #D4AF37; }
        button { background: #D4AF37; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #B8941F; }
        pre { background: #333; color: #fff; padding: 15px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test API WooCommerce - Estudio Artesana</h1>
        
        <div class="test-section">
            <h2>üîß Configuraci√≥n API</h2>
            <div id="config-info">Cargando configuraci√≥n...</div>
        </div>
        
        <div class="test-section">
            <h2>üìÇ Test de Categor√≠as</h2>
            <button onclick="testCategories()">Probar Categor√≠as</button>
            <div id="categories-result">Presiona el bot√≥n para probar</div>
        </div>
        
        <div class="test-section">
            <h2>üõçÔ∏è Test de Productos</h2>
            <button onclick="testProducts()">Probar Productos</button>
            <div id="products-result">Presiona el bot√≥n para probar</div>
        </div>
        
        <div class="test-section">
            <h2>üè† Test Homepage Categories</h2>
            <button onclick="testHomepageCategories()">Simular Carga Homepage</button>
            <div id="homepage-result">Presiona el bot√≥n para probar</div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/config.js"></script>
    <script src="assets/js/woocommerce-api.js"></script>
    
    <script>
        // Initialize API
        window.WooAPI = new WooCommerceAPI();
        
        // Show config info
        document.addEventListener('DOMContentLoaded', function() {
            const configDiv = document.getElementById('config-info');
            if (window.EstudioArtesanaConfig && window.EstudioArtesanaConfig.woocommerce) {
                const config = window.EstudioArtesanaConfig.woocommerce;
                configDiv.innerHTML = `
                    <strong>‚úÖ Configuraci√≥n cargada:</strong><br>
                    üåê Base URL: ${config.baseURL}<br>
                    üîë Consumer Key: ${config.consumerKey.substring(0, 10)}...<br>
                    üîê Consumer Secret: ${config.consumerSecret.substring(0, 10)}...<br>
                `;
                
                // Set API credentials
                window.WooAPI.setCredentials(config.consumerKey, config.consumerSecret);
                window.WooAPI.config.baseURL = config.baseURL;
            } else {
                configDiv.innerHTML = '<span class="error">‚ùå No se pudo cargar la configuraci√≥n</span>';
            }
        });
        
        async function testCategories() {
            const resultDiv = document.getElementById('categories-result');
            resultDiv.innerHTML = '<div class="loading">üîÑ Probando conexi√≥n con categor√≠as...</div>';
            
            try {
                const categories = await window.WooAPI.getCategories({
                    hide_empty: true,
                    per_page: 10,
                    orderby: 'count',
                    order: 'desc'
                });
                
                if (categories && categories.length > 0) {
                    let html = '<div class="success">‚úÖ Categor√≠as cargadas exitosamente!</div>';
                    html += `<p><strong>Total encontradas:</strong> ${categories.length}</p>`;
                    
                    categories.forEach(cat => {
                        html += `
                            <div class="category-item">
                                <strong>${cat.name}</strong> (ID: ${cat.id})<br>
                                üì¶ ${cat.count} productos<br>
                                ${cat.image ? 'üñºÔ∏è Tiene imagen' : '‚ùå Sin imagen'}<br>
                                üîó Slug: ${cat.slug}
                            </div>
                        `;
                    });
                    
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ö†Ô∏è No se encontraron categor√≠as</div>';
                }
                
            } catch (error) {
                console.error('Error testing categories:', error);
                resultDiv.innerHTML = `
                    <div class="error">‚ùå Error al conectar con categor√≠as:</div>
                    <pre>${error.message}</pre>
                `;
            }
        }
        
        async function testProducts() {
            const resultDiv = document.getElementById('products-result');
            resultDiv.innerHTML = '<div class="loading">üîÑ Probando conexi√≥n con productos...</div>';
            
            try {
                const products = await window.WooAPI.getProducts({
                    per_page: 5,
                    status: 'publish'
                });
                
                if (products && products.length > 0) {
                    let html = '<div class="success">‚úÖ Productos cargados exitosamente!</div>';
                    html += `<p><strong>Muestra de productos:</strong> ${products.length}</p>`;
                    
                    products.forEach(prod => {
                        html += `
                            <div class="category-item">
                                <strong>${prod.name}</strong> (ID: ${prod.id})<br>
                                üí∞ $${prod.price}<br>
                                üì¶ Stock: ${prod.stock_status}<br>
                                üè∑Ô∏è Categor√≠as: ${prod.categories.map(c => c.name).join(', ')}
                            </div>
                        `;
                    });
                    
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ö†Ô∏è No se encontraron productos</div>';
                }
                
            } catch (error) {
                console.error('Error testing products:', error);
                resultDiv.innerHTML = `
                    <div class="error">‚ùå Error al conectar con productos:</div>
                    <pre>${error.message}</pre>
                `;
            }
        }
        
        async function testHomepageCategories() {
            const resultDiv = document.getElementById('homepage-result');
            resultDiv.innerHTML = '<div class="loading">üîÑ Simulando carga de categor√≠as para homepage...</div>';
            
            try {
                // Simulate the same logic as home-categories.js
                const allCategories = await window.WooAPI.getCategories({
                    hide_empty: true,
                    per_page: 50,
                    orderby: 'count',
                    order: 'desc'
                });
                
                const topCategories = allCategories.slice(0, 6); // Same as maxCategories
                
                if (topCategories && topCategories.length > 0) {
                    let html = '<div class="success">‚úÖ Homepage categories simulation successful!</div>';
                    html += `<p><strong>Top 6 categor√≠as para homepage:</strong></p>`;
                    
                    topCategories.forEach((cat, index) => {
                        const badgeText = cat.count >= 20 ? 'Popular' : cat.count >= 10 ? 'Nueva' : null;
                        html += `
                            <div class="category-item">
                                <strong>#${index + 1} ${cat.name}</strong><br>
                                üì¶ ${cat.count} productos<br>
                                ${badgeText ? `üèÜ Badge: ${badgeText}` : '‚ö™ Sin badge'}<br>
                                ${cat.image ? 'üñºÔ∏è Imagen WooCommerce disponible' : 'üé® Usar√° imagen local/SVG'}<br>
                                üîó Link: pages/tienda/index.html?category=${cat.id}
                            </div>
                        `;
                    });
                    
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = '<div class="error">‚ö†Ô∏è No se encontraron categor√≠as para homepage</div>';
                }
                
            } catch (error) {
                console.error('Error testing homepage categories:', error);
                resultDiv.innerHTML = `
                    <div class="error">‚ùå Error en simulaci√≥n de homepage:</div>
                    <pre>${error.message}</pre>
                `;
            }
        }
    </script>
</body>
</html>
